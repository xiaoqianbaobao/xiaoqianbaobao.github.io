<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>é˜…è¯»Springæºç  | Qian&#39;s Blog</title>
<meta name="keywords" content="spring">
<meta name="description" content="Spring ä»€ä¹ˆæ˜¯Springæ¡†æ¶ Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPrin">
<meta name="author" content="
ä½œè€…:&nbsp;ShengQian">
<link rel="canonical" href="https://csqread.top/posts/tech/%E9%98%85%E8%AF%BBspring%E6%BA%90%E7%A0%81/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d056c2d8b86c8da0db95897f49066a3a22d796d21ff6173ef98b613234e402fe.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity=""
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://csqread.top/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://csqread.top/img/%21.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://csqread.top/img/%21.jpg">
<link rel="apple-touch-icon" href="https://csqread.top/%21.jpg">
<link rel="mask-icon" href="https://csqread.top/%21.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="é˜…è¯»Springæºç " />
<meta property="og:description" content="Spring ä»€ä¹ˆæ˜¯Springæ¡†æ¶ Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPrin" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://csqread.top/posts/tech/%E9%98%85%E8%AF%BBspring%E6%BA%90%E7%A0%81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-12T21:13:28+08:00" />
<meta property="article:modified_time" content="2024-04-12T21:13:28+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="é˜…è¯»Springæºç "/>
<meta name="twitter:description" content="Spring ä»€ä¹ˆæ˜¯Springæ¡†æ¶ Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPrin"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://csqread.top/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "æŠ€æœ¯",
      "item": "https://csqread.top/posts/tech/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "é˜…è¯»Springæºç ",
      "item": "https://csqread.top/posts/tech/%E9%98%85%E8%AF%BBspring%E6%BA%90%E7%A0%81/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é˜…è¯»Springæºç ",
  "name": "é˜…è¯»Springæºç ",
  "description": "Spring ä»€ä¹ˆæ˜¯Springæ¡†æ¶ Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPrin",
  "keywords": [
    "spring"
  ],
  "articleBody": "Spring ä»€ä¹ˆæ˜¯Springæ¡†æ¶ Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚ æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPring Frameworkï¼Œä»–æ˜¯å¾ˆå¤šæ¨¡å—çš„é›†åˆï¼Œä½¿ç”¨è¿™äº›æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿çš„ååŠ©æˆ‘ä»¬è¿›è¡Œå¼€å‘ã€‚è¿™äº›æ¨¡å—æ˜¯æ ¸å¿ƒå®¹å™¨ã€æ•°æ®è®¿é—®/é›†æˆã€webã€aopã€å·¥å…·ã€æ¶ˆæ¯å’Œæµ‹è¯•æ¨¡å—ã€‚æ¯”å¦‚Core Containerä¸­çš„Coreç»„ä»¶æ˜¯Springæ‰€æœ‰ç»„ä»¶çš„æ ¸å¿ƒï¼ŒBeansç»„ä»¶å’ŒContextç»„ä»¶æ˜¯å®ç°IOCå’ŒDIçš„åŸºç¡€ï¼ŒAOPç»„ä»¶ç”¨æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚\nSpringå®˜ç½‘åˆ—å‡ºæ¥çš„Springçš„6ä¸ªç‰¹å¾:\næ ¸å¿ƒæŠ€æœ¯ï¼šä¾èµ–æ³¨å…¥ï¼Œaopï¼Œäº‹ä»¶ï¼Œèµ„æºï¼Œi18nï¼ŒéªŒè¯ï¼Œæ•°æ®ç»‘å®šï¼Œç±»å‹è½¬æ¢ï¼ŒSpEL æµ‹è¯•ï¼šæ¨¡æ‹Ÿå¯¹è±¡ï¼ŒTestContextæ¡†æ¶ï¼ŒSPringMVCæµ‹è¯•ï¼ŒWebTestClient æ•°æ®è®¿é—®:äº‹åŠ¡ï¼ŒDAOæ”¯æŒï¼ŒJDBCï¼ŒORMï¼Œç¼–ç»„XML Webæ”¯æŒ:Spring MVCå’ŒSPring WebFlux Webæ¡†æ¶ é›†æˆ:è¿œç¨‹å¤„ç†ï¼ŒJMSï¼ŒJCAï¼ŒJMXï¼Œç”µå­é‚®ä»¶ï¼Œä»»åŠ¡ï¼Œè°ƒåº¦ï¼Œç¼“å­˜ è¯­è¨€ï¼šKotlinï¼ŒGroovyï¼ŒåŠ¨æ€è¯­è¨€ Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ å¤§éƒ¨åˆ†æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹beanå­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„éé™æ€æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚\næœ‰ä¸¤ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼š 1ã€åœ¨beanå¯¹è±¡ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ã€‚ 2ã€åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨ThreadLocalä¸­ã€‚\nSpringä¸­çš„beanç”Ÿå‘½å‘¨æœŸï¼Ÿ Beançš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç»å†äº†å„ç§æ–¹æ³•è°ƒç”¨ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š\nBeanè‡ªèº«çš„æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†Beanæœ¬èº«è°ƒç”¨çš„æ–¹æ³•å’Œé€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„init-methodå’Œdestroy-methodæŒ‡å®šçš„æ–¹æ³• Beançº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†BeanNameAwareã€BeanFactoryAwareã€ApplicationContext;å½“ç„¶ä¹ŸåŒ…æ‹¬InitializingBeanå’ŒDiposableBeanè¿™äº›æ¥å£çš„æ–¹æ³• å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†InstantiationAwareBeanPostProcessorå’ŒBeanPostProcessorè¿™ä¸¤ä¸ªæ¥å£å®ç°ï¼Œä¸€èˆ¬ç§°å®ƒä»¬çš„å®ç°ç±»ä¸ºâ€œåå¤„ç†å™¨â€ å·¥å‚åå¤„ç†å™¨æ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†AspectJWeavingEnabler,ConfigurationClassPostProcessor,CustomAutowireConfigurerç­‰ç­‰éå¸¸æœ‰ç”¨çš„å·¥å‚åå¤„ç†æ¥å£çš„æ–¹æ³•ã€‚å·¥å‚åå¤„ç†å™¨ä¹Ÿæ˜¯å®¹å™¨çº§çš„ã€‚åœ¨åº”ç”¨ä¸Šä¸‹æ–‡è£…é…é…ç½®æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨ã€‚ å¦‚ä½•å°†Beanä»XMLé…ç½®ä¸­è§£æåæ”¾åˆ°IoCå®¹å™¨ä¸­å¾—ï¼Ÿ åˆå§‹åŒ–çš„å…¥å£ å¯¹äºxmlé…ç½®çš„Springåº”ç”¨ï¼Œåœ¨main()æ–¹æ³•ä¸­å®ä¾‹åŒ–ClasspathXmlApplicationå³å¯åˆ›å»ºä¸€ä¸ªIoCå®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªæ„é€ æ–¹æ³•å¼€å§‹ï¼Œæ¢ç©¶ä¸€ä¸‹IoCå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚\n1 2 // create and configure beans ApplicationContext context = new ClassPathXmlApplicationContext(\"aspects.xml\", \"daos.xml\", \"services.xml\"); 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public ClassPathXmlApplicationContext(String... configLocations) throws BeansException { this(configLocations, true, (ApplicationContext)null); } public ClassPathXmlApplicationContext(String[] configLocations, boolean refresh, @Nullable ApplicationContext parent) throws BeansException { // è®¾ç½®Beanèµ„æºåŠ è½½å™¨ super(parent); // è®¾ç½®é…ç½®è·¯å¾„ this.setConfigLocations(configLocations); // åˆå§‹åŒ–å®¹å™¨ if (refresh) { this.refresh(); } } è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ è°ƒç”¨çˆ¶ç±»å®¹å™¨AbstractApplicationContextçš„æ„é€ æ–¹æ³•(super(parent)æ–¹æ³•)ä¸ºå®¹å™¨è®¾ç½®å¥½Beanèµ„æºåŠ è½½å™¨\n1 2 3 4 5 6 7 public AbstractApplicationContext(@Nullable ApplicationContext parent) { // é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–å®¹å™¨id, name, çŠ¶æ€ ä»¥åŠ èµ„æºè§£æå™¨ this(); // å°†çˆ¶å®¹å™¨çš„Environmentåˆå¹¶åˆ°å½“å‰å®¹å™¨ this.setParent(parent); } é€šè¿‡AbstractApplicationContexté»˜è®¤æ„é€ å™¨åˆå§‹åŒ–å®¹å™¨id,name,çŠ¶æ€ä»¥åŠèµ„æºè§£æå™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public AbstractApplicationContext() { this.logger = LogFactory.getLog(this.getClass()); this.id = ObjectUtils.identityToString(this); this.displayName = ObjectUtils.identityToString(this); this.beanFactoryPostProcessors = new ArrayList(); this.active = new AtomicBoolean(); this.closed = new AtomicBoolean(); this.startupShutdownMonitor = new Object(); this.applicationStartup = ApplicationStartup.DEFAULT; this.applicationListeners = new LinkedHashSet(); this.resourcePatternResolver = this.getResourcePatternResolver(); } // Springèµ„æºåŠ è½½å™¨ protected ResourcePatternResolver getResourcePatternResolver() { return new PathMatchingResourcePatternResolver(this); } é€šè¿‡AbstractApplicationContextçš„setParent(parent)æ–¹æ³•å°†çˆ¶å®¹å™¨çš„Enviromentåˆå¹¶åˆ°å½“å‰å®¹å™¨\n1 2 3 4 5 6 7 8 9 public void setParent(@Nullable ApplicationContext parent) { this.parent = parent; if (parent != null) { Environment parentEnvironment = parent.getEnvironment(); if (parentEnvironment instanceof ConfigurableEnvironment) { this.getEnvironment().merge((ConfigurableEnvironment)parentEnvironment); } } } è®¾ç½®é…ç½®è·¯å¾„ åœ¨è®¾ç½®å®¹å™¨çš„èµ„æºåŠ è½½å™¨ä¹‹åï¼Œæ¥ä¸‹æ¥FileSystemXmlApplicationContentæ‰§è¡ŒsetConfigLocationsæ–¹æ³•é€šè¿‡è°ƒç”¨å…¶çˆ¶ç±»AbstractRefreshableConfigApplicationContextçš„æ–¹æ³•è¿›è¡Œå¯¹Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„å®šä½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public void setConfigLocations(@Nullable String... locations) { if (locations != null) { Assert.noNullElements(locations, \"Config locations must not be null\"); this.configLocations = new String[locations.length]; for(int i = 0; i \u003c locations.length; ++i) { // è§£æé…ç½®è·¯å¾„ this.configLocations[i] = this.resolvePath(locations[i]).trim(); } } else { this.configLocations = null; } } protected String resolvePath(String path) { // ä»ä¸Šä¸€æ­¥Environmentä¸­è§£æ return this.getEnvironment().resolveRequiredPlaceholders(path); } åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹ Spring IoCå®¹å™¨å¯¹Beanå®šä¹‰èµ„æºçš„åŠ è½½æ˜¯ä»refresh()å‡½æ•°å¼€å§‹çš„ï¼Œrefresh()æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œrefresh()æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šåœ¨åˆ›å»ºIoCå®¹å™¨å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refresh()ä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚refreshçš„ä½œç”¨ç±»ä¼¼äºå¯¹IoCå®¹å™¨çš„é‡å¯ï¼Œåœ¨æ–°å»ºç«‹å¥½çš„å®¹å™¨ä¸­å¯¹å®¹å™¨è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹Beanå®šä¹‰èµ„æºè¿›è¡Œè½½å…¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 @Override public void refresh() throws BeansException, IllegalStateException { synchronized (this.startupShutdownMonitor) { StartupStep contextRefresh = this.applicationStartup.start(\"spring.context.refresh\"); // Prepare this context for refreshing. prepareRefresh(); // Tell the subclass to refresh the internal bean factory. ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); // Prepare the bean factory for use in this context. prepareBeanFactory(beanFactory); try { // Allows post-processing of the bean factory in context subclasses. postProcessBeanFactory(beanFactory); StartupStep beanPostProcess = this.applicationStartup.start(\"spring.context.beans.post-process\"); // Invoke factory processors registered as beans in the context. invokeBeanFactoryPostProcessors(beanFactory); // Register bean processors that intercept bean creation. registerBeanPostProcessors(beanFactory); beanPostProcess.end(); // Initialize message source for this context. initMessageSource(); // Initialize event multicaster for this context. initApplicationEventMulticaster(); // Initialize other special beans in specific context subclasses. onRefresh(); // Check for listener beans and register them. registerListeners(); // Instantiate all remaining (non-lazy-init) singletons. finishBeanFactoryInitialization(beanFactory); // Last step: publish corresponding event. finishRefresh(); } catch (BeansException ex) { if (logger.isWarnEnabled()) { logger.warn(\"Exception encountered during context initialization - \" + \"cancelling refresh attempt: \" + ex); } // Destroy already created singletons to avoid dangling resources. destroyBeans(); // Reset 'active' flag. cancelRefresh(ex); // Propagate exception to caller. throw ex; } finally { // Reset common introspection caches in Spring's core, since we // might not ever need metadata for singleton beans anymore... resetCommonCaches(); contextRefresh.end(); } } } è¿™é‡Œçš„è®¾è®¡ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„èµ„æºç±»åŠ è½½å¤„ç†å‹çš„æ€è·¯\næ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œæ¨¡æ¿æ–¹æ³•ä¸­ä½¿ç”¨å…¸å‹çš„é’©å­æ–¹æ³• å°†å…·ä½“çš„åˆå§‹åŒ–åŠ è½½æ–¹æ³•æ’å…¥åˆ°é’©å­æ–¹æ³•ä¹‹é—´ å°†åˆå§‹åŒ–çš„é˜¶æ®µå°è£…ï¼Œç”¨æ¥è®°å½•å½“å‰åˆå§‹åŒ–åˆ°ä»€ä¹ˆé˜¶æ®µï¼›å¸¸è§çš„è®¾è®¡æ˜¯xxxPhase/xxxStage èµ„æºåŠ è½½åˆå§‹åŒ–æœ‰å¤±è´¥ç­‰å¤„ç†ï¼Œå¿…ç„¶æ˜¯try/catch/finally åˆå§‹åŒ–BeanFactoryä¹‹obtainFreshBeanFactory AbstractApplicationContextçš„obtainFreshBeanFactory()æ–¹æ³•è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•ï¼Œå¯åŠ¨å®¹å™¨è½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹\n1 2 3 4 5 protected ConfigurableListableBeanFactory obtainFreshBeanFactory() { // è¿™é‡Œä½¿ç”¨äº†å§”æ´¾è®¾è®¡æ¨¡å¼ï¼Œçˆ¶ç±»å®šä¹‰äº†æŠ½è±¡çš„refreshBeanFactory()æ–¹æ³•ï¼Œå…·ä½“å®ç°è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³• refreshBeanFactory(); return getBeanFactory(); } AbstractApplicationCOntextç±»ä¸­åªæŠ½è±¡å®šä¹‰äº†refreshBeanFactory()æ–¹æ³•ï¼Œå®¹å™¨çœŸæ­£è°ƒç”¨çš„æ˜¯å­ç±»çš„AbstractRefreshableApplicationContextå®ç°çš„refreshBeanFactoryï¼ˆï¼‰æ–¹æ³•ç•™åœ¨åˆ›å»ºIoCå®¹å™¨ä¹‹å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚æ–¹æ³•æºç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 protected final void refreshBeanFactory() throws BeansException { // å¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ if (hasBeanFactory()) { destroyBeans(); closeBeanFactory(); } try { // åˆ›å»ºDefaultListableBeanFactoryï¼Œå¹¶è°ƒç”¨loadBeanDefinitions(beanFactory)è£…è½½beanå®šä¹‰ DefaultListableBeanFactory beanFactory = createBeanFactory(); beanFactory.setSerializationId(getId()); customizeBeanFactory(beanFactory); // å¯¹IoCå®¹å™¨è¿›è¡Œå®šåˆ¶åŒ–ï¼Œå¦‚è®¾ç½®å¯åŠ¨å‚æ•°ï¼Œå¼€å¯æ³¨è§£çš„è‡ªåŠ¨è£…é…ç­‰ loadBeanDefinitions(beanFactory); // è°ƒç”¨è½½å…¥Beanå®šä¹‰çš„æ–¹æ³•ï¼Œä¸»è¦è¿™é‡Œåˆä½¿ç”¨äº†ä¸€ä¸ªå§”æ´¾æ¨¡å¼ï¼Œåœ¨å½“å‰ç±»ä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå…·ä½“çš„å®ç°è°ƒç”¨å­ç±»å®¹å™¨ this.beanFactory = beanFactory; } catch (IOException ex) { throw new ApplicationContextException(\"I/O error parsing bean definition source for \" + getDisplayName(), ex); } } åˆå§‹åŒ–BeanFactoryä¹‹loadBeanDefinitions AbstractRefreshableApplicationContextä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå®¹å™¨çœŸæ­£è°ƒç”¨çš„æ˜¯å…¶å­ç±»çš„AbstractXmlApplicationContextå¯¹è¯¥æ–¹æ³•çš„å®ç°ï¼ŒAbstractXmlApplicationContextçš„ä¸»è¦æºç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException { // åˆ›å»ºXmlBeanDefinitionReaderï¼Œå³åˆ›å»ºBeanè¯»å–å™¨ï¼Œå¹¶é€šè¿‡å›è°ƒè®¾ç½®åˆ°å®¹å™¨ä¸­å»ï¼Œå®¹å™¨ä½¿ç”¨è¯¥è¯»å–å™¨è¯»å–Beanå®šä¹‰èµ„æº XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory); // é…ç½®ä¸Šä¸‹æ–‡çš„ç¯å¢ƒï¼Œèµ„æºåŠ è½½å™¨ã€è§£æå™¨ beanDefinitionReader.setEnvironment(this.getEnvironment()); beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this)); // ä¸ºBeanè¯»å–å™¨è®¾ç½®SAX xmlè§£æå™¨ // å…è®¸å­ç±»è‡ªè¡Œåˆå§‹åŒ–ï¼ˆæ¯”å¦‚æ ¡éªŒæœºåˆ¶ï¼‰ï¼Œå¹¶æä¾›çœŸæ­£çš„åŠ è½½æ–¹æ³• initBeanDefinitionReader(beanDefinitionReader); // å½“Beanè¯»å–å™¨è¯»å–Beanå®šä¹‰çš„Xmlèµ„æºæ–‡ä»¶æ—¶ï¼Œå¯ç”¨Xmlçš„æ ¡éªŒæœºåˆ¶ loadBeanDefinitions(beanDefinitionReader); } protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException { // åŠ è½½XMLé…ç½®æ–¹å¼é‡Œçš„Beanå®šä¹‰çš„èµ„æº Resource[] configResources = getConfigResources(); if (configResources != null) { reader.loadBeanDefinitions(configResources); } // åŠ è½½æ„é€ å‡½æ•°é‡Œé…ç½®çš„Beané…ç½®æ–‡ä»¶ï¼Œå³{\"aspects.xml\", \"daos.xml\", \"services.xml\"} String[] configLocations = getConfigLocations(); if (configLocations != null) { reader.loadBeanDefinitions(configLocations); } } Xml Beanè¯»å–å™¨(XmBeanDefinitionReader)è°ƒç”¨å…¶çˆ¶ç±»AbstractBeanDefinitionReaderçš„reader.loadBeanDefinitionsæ–¹æ³•è¯»å–beanå®šä¹‰èµ„æº\nç”±äºæˆ‘ä»¬ä½¿ç”¨ClassPathXmlApplicationCOntextä½œä¸ºä¾‹å­åˆ†æï¼Œå› æ­¤getConfigResourcesçš„è¿”å›å€¼ä¸ºnullï¼Œå› æ­¤ç¨‹åºæ‰§è¡Œreader,loadBeanDefinitions(configLocations)åˆ†æ”¯ã€‚\nAbstractBeanDefinitionReaderè¯»å–Beanå®šä¹‰èµ„æº AbstractBeanDifinitionReaderçš„loadBeanDefinitionsæ–¹æ³•æºç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 @Override public int loadBeanDefinitions(String location) throws BeanDefinitionStoreException { return loadBeanDefinitions(location, null); } public int loadBeanDefinitions(String location, @Nullable Set actualResources) throws BeanDefinitionStoreException { ResourceLoader resourceLoader = getResourceLoader(); if (resourceLoader == null) { throw new BeanDefinitionStoreException( \"Cannot load bean definitions from location [\" + location + \"]: no ResourceLoader available\"); } // æ¨¡å¼åŒ¹é…ç±»å‹çš„è§£æå™¨ï¼Œè¿™ç§æ–¹å¼æ˜¯åŠ è½½å¤šä¸ªæ»¡è¶³åŒ¹é…æ¡ä»¶çš„èµ„æº if (resourceLoader instanceof ResourcePatternResolver) { try { // è·å–åˆ°è¦åŠ è½½çš„èµ„æº Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location); int count = loadBeanDefinitions(resources); // å§”æ´¾è°ƒç”¨å…¶å­ç±»XmlBeanDefinitionReaderçš„æ–¹æ³•ï¼Œå®ç°åŠ è½½åŠŸèƒ½ if (actualResources != null) { Collections.addAll(actualResources, resources); } if (logger.isTraceEnabled()) { logger.trace(\"Loaded \" + count + \" bean definitions from location pattern [\" + location + \"]\"); } return count; } catch (IOException ex) { throw new BeanDefinitionStoreException( \"Could not resolve bean definition resource pattern [\" + location + \"]\", ex); } } else { // åªèƒ½é€šè¿‡ç»å¯¹è·¯å¾„URLåŠ è½½å•ä¸ªèµ„æº. Resource resource = resourceLoader.getResource(location); int count = loadBeanDefinitions(resource); if (actualResources != null) { actualResources.add(resource); } if (logger.isTraceEnabled()) { logger.trace(\"Loaded \" + count + \" bean definitions from location [\" + location + \"]\"); } return count; } } ä»å¯¹AbstractBeanDefinitionReaderçš„loadBeanDefinitionsæ–¹æ³•æºç åˆ†æå¯ä»¥çœ‹å‡ºè¯¥æ–¹æ³•åšäº†ä»¥ä¸‹ä¸¤ä»¶äº‹:\n1ã€é¦–å…ˆï¼Œè°ƒç”¨èµ„æºåŠ è½½å™¨çš„è·å–èµ„æºæ–¹æ³•resourceLoader.getResource(location)ï¼Œè·å–åˆ°è¦åŠ è½½çš„èµ„æºã€‚ 2ã€å…¶æ¬¡ï¼ŒçœŸæ­£æ‰§è¡ŒåŠ è½½åŠŸèƒ½çš„æ˜¯å…¶å­ç±»XmlBeanDefinitionReaderçš„loadBeanDefinitionsæ–¹æ³•\nXmlBeanDefinitionReaderåŠ è½½Beanå®šä¹‰èµ„æº ç»§ç»­çœ‹å­ç±»XmlBeanDefinitionReaderçš„loadBeanDefinitions(Resourceâ€¦)æ–¹æ³•çœ‹åˆ°ä»£è¡¨beanæ–‡ä»¶çš„èµ„æºå®šä¹‰ä»¥åçš„è½½å…¥è¿‡ç¨‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * æœ¬è´¨ä¸Šæ˜¯åŠ è½½XMLé…ç½®çš„Beanã€‚ * @param inputSource the SAX InputSource to read from * @param resource the resource descriptor for the XML file */ protected int doLoadBeanDefinitions(InputSource inputSource, Resource resource) throws BeanDefinitionStoreException { try { Document doc = doLoadDocument(inputSource, resource); // å°†Beanå®šä¹‰èµ„æºè½¬æ¢æˆDocumentå¯¹è±¡ int count = registerBeanDefinitions(doc, resource); if (logger.isDebugEnabled()) { logger.debug(\"Loaded \" + count + \" bean definitions from \" + resource); } return count; } catch (BeanDefinitionStoreException ex) { throw ex; } catch (SAXParseException ex) { throw new XmlBeanDefinitionStoreException(resource.getDescription(), \"Line \" + ex.getLineNumber() + \" in XML document from \" + resource + \" is invalid\", ex); } catch (SAXException ex) { throw new XmlBeanDefinitionStoreException(resource.getDescription(), \"XML document from \" + resource + \" is invalid\", ex); } catch (ParserConfigurationException ex) { throw new BeanDefinitionStoreException(resource.getDescription(), \"Parser configuration exception parsing XML from \" + resource, ex); } catch (IOException ex) { throw new BeanDefinitionStoreException(resource.getDescription(), \"IOException parsing XML document from \" + resource, ex); } catch (Throwable ex) { throw new BeanDefinitionStoreException(resource.getDescription(), \"Unexpected exception parsing XML document from \" + resource, ex); } } // ä½¿ç”¨é…ç½®çš„DocumentLoaderåŠ è½½XMLå®šä¹‰æ–‡ä»¶ä¸ºDocument. protected Document doLoadDocument(InputSource inputSource, Resource resource) throws Exception { return this.documentLoader.loadDocument(inputSource, getEntityResolver(), this.errorHandler, getValidationModeForResource(resource), isNamespaceAware()); } é€šè¿‡æºç åˆ†æï¼Œè½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„æœ€åä¸€æ­¥æ˜¯å°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼Œè¯¥è¿‡ç¨‹ç”±documentLoaderå®ç°\nDocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡ DocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡çš„æºç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 // ä½¿ç”¨æ ‡å‡†çš„JAXPå°†è½½å…¥çš„Beanå®šä¹‰èµ„æºè½¬æ¢æˆdocumentå¯¹è±¡ @Override public Document loadDocument(InputSource inputSource, EntityResolver entityResolver, ErrorHandler errorHandler, int validationMode, boolean namespaceAware) throws Exception { // åˆ›å»ºæ–‡ä»¶è§£æå™¨å·¥å‚ DocumentBuilderFactory factory = createDocumentBuilderFactory(validationMode, namespaceAware); if (logger.isTraceEnabled()) { logger.trace(\"Using JAXP provider [\" + factory.getClass().getName() + \"]\"); } // åˆ›å»ºæ–‡æ¡£è§£æå™¨ DocumentBuilder builder = createDocumentBuilder(factory, entityResolver, errorHandler); return builder.parse(inputSource); // è§£æ } protected DocumentBuilderFactory createDocumentBuilderFactory(int validationMode, boolean namespaceAware) throws ParserConfigurationException { DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); factory.setNamespaceAware(namespaceAware); // è®¾ç½®è§£æXMLçš„æ ¡éªŒ if (validationMode != XmlValidationModeDetector.VALIDATION_NONE) { factory.setValidating(true); if (validationMode == XmlValidationModeDetector.VALIDATION_XSD) { // Enforce namespace aware for XSD... factory.setNamespaceAware(true); try { factory.setAttribute(SCHEMA_LANGUAGE_ATTRIBUTE, XSD_SCHEMA_LANGUAGE); } catch (IllegalArgumentException ex) { ParserConfigurationException pcex = new ParserConfigurationException( \"Unable to validate using XSD: Your JAXP provider [\" + factory + \"] does not support XML Schema. Are you running on Java 1.4 with Apache Crimson? \" + \"Upgrade to Apache Xerces (or Java 1.5) for full XSD support.\"); pcex.initCause(ex); throw pcex; } } } return factory; } è¯¥è§£æè¿‡ç¨‹è°ƒç”¨JavaEEæ ‡å‡†çš„JAXPæ ‡å‡†è¿›è¡Œå¤„ç†ã€‚\nè‡³æ­¤Spring IoCå®¹å™¨æ ¹æ®å®šä½çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶ï¼Œå°†å…¶åŠ è½½è¯»å…¥å¹¶è½¬æ¢æˆä¸ºDocumentå¯¹è±¡è¿‡ç¨‹å®Œæˆã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æSpring IoCå®¹å™¨å°†è½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ä¹‹åï¼Œæ˜¯å¦‚ä½•å°†å…¶è§£æä¸ºSpring IoCç®¡ç†çš„Beanå¯¹è±¡ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„ã€‚\nXmlBeanDefinitionReaderè§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶ XmlBeanDefinitionReaderç±»ä¸­çš„doLoadBeanDefinitionsæ–¹æ³•æ˜¯ä»ç‰¹å®šçš„XMLæ–‡ä»¶ä¸­å®é™…è½½å…¥Beanå®šä¹‰èµ„æºçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è½½å…¥Beanå®šä¹‰èµ„æºä¹‹åå°†å…¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼Œæ¥ä¸‹æ¥è°ƒç”¨registerBeanDefinitionså¯åŠ¨Spring IoCå®¹å™¨å¯¹Beanå®šä¹‰çš„è§£æè¿‡ç¨‹ï¼ŒregisterBeanDefinitionæ–¹æ³•æºç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // æŒ‰ç…§Springçš„Beanè¯­ä¹‰è¦æ±‚å°†Beanå®šä¹‰èµ„æºè§£æå¹¶è½¬æ¢ä¸ºå®¹å™¨å†…éƒ¨æ•°æ®ç»“æ„ public int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException { BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader(); int countBefore = getRegistry().getBeanDefinitionCount(); // è§£æè¿‡ç¨‹å…¥å£ï¼Œè¿™é‡Œä½¿ç”¨äº†å§”æ´¾æ¨¡å¼ï¼Œå…·ä½“çš„è§£æå®ç°è¿‡ç¨‹æœ‰å®ç°ç±»DefaultBeanDefinitionDocumentReaderå®Œæˆ documentReader.registerBeanDefinitions(doc, createReaderContext(resource)); return getRegistry().getBeanDefinitionCount() - countBefore; // è¿”å›æ­¤æ¬¡è§£æäº†å¤šå°‘ä¸ªå¯¹è±¡ } // åˆ›å»ºBeanDefinitionDocumentReaderå¯¹è±¡ï¼Œè§£æDocumentå¯¹è±¡ protected BeanDefinitionDocumentReader createBeanDefinitionDocumentReader() { return BeanUtils.instantiateClass(this.documentReaderClass); } /** * Create the {@link XmlReaderContext} to pass over to the document reader. */ public XmlReaderContext createReaderContext(Resource resource) { return new XmlReaderContext(resource, this.problemReporter, this.eventListener, this.sourceExtractor, this, getNamespaceHandlerResolver()); } Beanå®šä¹‰èµ„æºçš„è½½å…¥è§£æåˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹:\n1ã€é¦–å…ˆï¼Œé€šè¿‡è°ƒç”¨XMLè§£æå™¨å°†Beanå®šä¹‰èµ„æºæ–‡ä»¶è½¬æ¢å¾—åˆ°Documentå¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›Documentå¯¹è±¡å¹¶æ²¡æœ‰æŒ‰ç…§Springçš„Beanè§„åˆ™è¿›è¡Œè§£æã€‚è¿™ä¸€éƒ¨æ˜¯è½½å…¥çš„è¿‡ç¨‹ 2ã€å…¶æ¬¡ï¼Œåœ¨å®Œæˆé€šç”¨çš„XMLè§£æä¹‹åï¼ŒæŒ‰ç…§Springçš„Beanè§„åˆ™å¯¹Documentå¯¹è±¡è¿›è¡Œè§£æã€‚\næŒ‰ç…§Springçš„Beanè§„åˆ™å¯¹Documentå¯¹è±¡è§£æçš„è¿‡ç¨‹æ˜¯åœ¨æ¥å£BeanDifinitionDocumentReaderçš„å®ç°ç±»DefaultBeanDefinitionDocumentReaderä¸­å®ç°çš„ã€‚\nDefaultBeanDefinitionDocumentReaderå¯¹beanå®šä¹‰çš„Documentå¯¹è±¡è§£æ BeanDefinitionDocumentReaderæ¥å£é€šè¿‡registerBeanDefinitionsæ–¹æ³•è°ƒç”¨å…¶å®ç°ç±»DefaultBeanDefinitionDocumentReaderå¯¹Documentå¯¹è±¡è¿›è¡Œè§£æï¼Œè§£æä»£ç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 @Override public void registerBeanDefinitions(Document doc, XmlReaderContext readerContext) { this.readerContext = readerContext; doRegisterBeanDefinitions(doc.getDocumentElement()); } // æ³¨å†Œé…ç½®çš„Beans @SuppressWarnings(\"deprecation\") // for Environment.acceptsProfiles(String...) protected void doRegisterBeanDefinitions(Element root) { // Any nested elements will cause recursion in this method. In // order to propagate and preserve default-* attributes correctly, // keep track of the current (parent) delegate, which may be null. Create // the new (child) delegate with a reference to the parent for fallback purposes, // then ultimately reset this.delegate back to its original (parent) reference. // this behavior emulates a stack of delegates without actually necessitating one. BeanDefinitionParserDelegate parent = this.delegate; this.delegate = createDelegate(getReaderContext(), root, parent); if (this.delegate.isDefaultNamespace(root)) { String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE); if (StringUtils.hasText(profileSpec)) { String[] specifiedProfiles = StringUtils.tokenizeToStringArray( profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS); // We cannot use Profiles.of(...) since profile expressions are not supported // in XML config. See SPR-12458 for details. if (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) { if (logger.isDebugEnabled()) { logger.debug(\"Skipped XML bean definition file due to specified profiles [\" + profileSpec + \"] not matching: \" + getReaderContext().getResource()); } return; } } } preProcessXml(root); parseBeanDefinitions(root, this.delegate); // ä»Documentçš„æ ¹å…ƒç´ å¼€å§‹è¿›è¡ŒBeanå®šä¹‰çš„Documentå¯¹è±¡ postProcessXml(root); this.delegate = parent; } BeanDefinitionParserDelegate è§£æBeanå®šä¹‰èµ„æºæ–‡ä»¶ç”ŸæˆBeanDefinition 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 /** * Parse the elements at the root level in the document: * \"import\", \"alias\", \"bean\". * @param root the DOM root element of the document */ protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) { if (delegate.isDefaultNamespace(root)) { NodeList nl = root.getChildNodes(); for (int i = 0; i \u003c nl.getLength(); i++) { Node node = nl.item(i); if (node instanceof Element) { Element ele = (Element) node; if (delegate.isDefaultNamespace(ele)) { parseDefaultElement(ele, delegate); } else { delegate.parseCustomElement(ele); } } } } else { delegate.parseCustomElement(root); } } private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) { // å¦‚æœå…ƒç´ èŠ‚ç‚¹æ˜¯å¯¼å…¥å…ƒç´ ï¼Œè¿›è¡Œå¯¼å…¥è§£æ if (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) { importBeanDefinitionResource(ele); } // å¦‚æœå…ƒç´ èŠ‚ç‚¹æ˜¯åˆ«åå…ƒç´ ï¼Œè¿›è¡Œåˆ«åè§£æ else if (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) { processAliasRegistration(ele); } // å¦‚æœå…ƒç´ èŠ‚ç‚¹å…ƒç´ , æŒ‰ç…§Springçš„Beanè§„åˆ™è§£æå…ƒç´  else if (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) { processBeanDefinition(ele, delegate); } // å¦‚æœå…ƒç´ èŠ‚ç‚¹å…ƒç´ ï¼Œå³å®ƒæ˜¯åµŒå¥—ç±»å‹çš„ else if (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) { // é€’å½’è§£æ doRegisterBeanDefinitions(ele); } } è§£æBeanç”ŸæˆBeanDefinitionHolderçš„æ–¹æ³•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 /** * Process the given bean element, parsing the bean definition * and registering it with the registry. */ protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) { BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele); if (bdHolder != null) { bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder); try { // æ³¨å†Œæœ€ç»ˆçš„è£…é¥°å®ä¾‹ BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry()); } catch (BeanDefinitionStoreException ex) { getReaderContext().error(\"Failed to register bean definition with name '\" + bdHolder.getBeanName() + \"'\", ele, ex); } // Send registration event. getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder)); } } è§£æè¿‡åçš„BeanDefinitionåœ¨IoCå®¹å™¨ä¸­æ³¨å†Œ Documentå¯¹è±¡çš„è§£æåå¾—åˆ°å°è£…BeanDefinitionçš„BeanDifinitionHoldå¯¹è±¡ï¼Œç„¶åè°ƒç”¨BeanDefinitionReaderUtilsçš„registerBeanDefinitionæ–¹æ³•å‘IoCå®¹å™¨æ³¨å†Œè§£æçš„Beanï¼ŒBeanDefinitionReaderUtilsçš„æ³¨å†Œçš„æºç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // é€šè¿‡BeanDefinitionRegistryå°†BeanDefinitionHolderæ³¨å†Œåˆ°BeanFactory public static void registerBeanDefinition( BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry) throws BeanDefinitionStoreException { // Register bean definition under primary name. String beanName = definitionHolder.getBeanName(); registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition()); // Register aliases for bean name, if any. String[] aliases = definitionHolder.getAliases(); if (aliases != null) { for (String alias : aliases) { registry.registerAlias(beanName, alias); } } } å½“è°ƒç”¨BeanDefinitionReaderUtilså‘IoCå®¹å™¨æ³¨å†Œè§£æçš„BeanDefinitionæ—¶ï¼ŒçœŸæ­£å®Œæˆæ³¨å†ŒåŠŸèƒ½çš„æ˜¯DefaultListableBeanFactory.\nDefaultListableBeanFactory å‘IoCå®¹å™¨æ³¨å†Œè§£æåçš„BeanDefinition IoCå®¹å™¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªbeanDefinitionMapï¼Œæ³¨å†Œå³å°†BeanDefinition put åˆ°mapä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 /** Map of bean definition objects, keyed by bean name. */ private final Map beanDefinitionMap = new ConcurrentHashMap\u003c\u003e(256); /** Map from bean name to merged BeanDefinitionHolder. */ private final Map mergedBeanDefinitionHolders = new ConcurrentHashMap\u003c\u003e(256); @Override public void registerBeanDefinition(String beanName, BeanDefinition beanDefinition) throws BeanDefinitionStoreException { Assert.hasText(beanName, \"Bean name must not be empty\"); Assert.notNull(beanDefinition, \"BeanDefinition must not be null\"); if (beanDefinition instanceof AbstractBeanDefinition) { try { ((AbstractBeanDefinition) beanDefinition).validate(); } catch (BeanDefinitionValidationException ex) { throw new BeanDefinitionStoreException(beanDefinition.getResourceDescription(), beanName, \"Validation of bean definition failed\", ex); } } BeanDefinition existingDefinition = this.beanDefinitionMap.get(beanName); // å¦‚æœå·²ç»æ³¨å†Œ if (existingDefinition != null) { // æ£€æŸ¥æ˜¯å¦å¯ä»¥è¦†ç›– if (!isAllowBeanDefinitionOverriding()) { throw new BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition); } else if (existingDefinition.getRole() \u003c beanDefinition.getRole()) { // e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE if (logger.isInfoEnabled()) { logger.info(\"Overriding user-defined bean definition for bean '\" + beanName + \"' with a framework-generated bean definition: replacing [\" + existingDefinition + \"] with [\" + beanDefinition + \"]\"); } } else if (!beanDefinition.equals(existingDefinition)) { if (logger.isDebugEnabled()) { logger.debug(\"Overriding bean definition for bean '\" + beanName + \"' with a different definition: replacing [\" + existingDefinition + \"] with [\" + beanDefinition + \"]\"); } } else { if (logger.isTraceEnabled()) { logger.trace(\"Overriding bean definition for bean '\" + beanName + \"' with an equivalent definition: replacing [\" + existingDefinition + \"] with [\" + beanDefinition + \"]\"); } } // è¦†ç›– this.beanDefinitionMap.put(beanName, beanDefinition); } else { if (hasBeanCreationStarted()) { // Cannot modify startup-time collection elements anymore (for stable iteration) synchronized (this.beanDefinitionMap) { this.beanDefinitionMap.put(beanName, beanDefinition); List updatedDefinitions = new ArrayList\u003c\u003e(this.beanDefinitionNames.size() + 1); updatedDefinitions.addAll(this.beanDefinitionNames); updatedDefinitions.add(beanName); this.beanDefinitionNames = updatedDefinitions; removeManualSingletonName(beanName); } } else { // Still in startup registration phase this.beanDefinitionMap.put(beanName, beanDefinition); this.beanDefinitionNames.add(beanName); removeManualSingletonName(beanName); } //é‡ç½®æ‰€æœ‰å·²ç»æ³¨å†Œè¿‡çš„BeanDefinitionçš„ç¼“å­˜ this.frozenBeanDefinitionNames = null; } if (existingDefinition != null || containsSingleton(beanName)) { resetBeanDefinition(beanName); } else if (isConfigurationFrozen()) { clearByTypeCache(); } } è‡³æ­¤ï¼ŒBeanå®šä¹‰èµ„æºæ–‡ä»¶ä¸­é…ç½®çš„Beanè¢«è§£æè¿‡åï¼Œå·²ç»æ³¨å†Œåˆ°IoCå®¹å™¨ä¸­ï¼Œè¢«å®¹å™¨ç®¡ç†èµ·æ¥ï¼ŒçœŸæ­£å®Œæˆäº†IoCå®¹å™¨åˆå§‹åŒ–æ‰€åšçš„å…¨éƒ¨å·¥ä½œã€‚ç°åœ¨IoCå®¹å™¨ä¸­å·²ç»å»ºç«‹äº†æ•´ä¸ªBeançš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›BeanDefinitionä¿¡æ¯å·²ç»å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è¢«æ£€ç´¢ï¼ŒIoCå®¹å™¨çš„ä½œç”¨å°±æ˜¯å¯¹è¿™äº›æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯è¿›è¡Œå¤„ç†å’Œç»´æŠ¤ã€‚è¿™äº›çš„æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯æ˜¯IoCå®¹å™¨æ§åˆ¶åè½¬çš„åŸºç¡€ï¼Œæ­£æ˜¯æœ‰äº†è¿™äº›æ³¨å†Œçš„æ•°æ®ï¼Œå®¹å™¨æ‰å¯ä»¥è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚\næ€»ç»“ ç°åœ¨é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæ€»ç»“ä¸€ä¸‹IoCå®¹å™¨åˆå§‹åŒ–çš„åŸºæœ¬æ­¥éª¤ï¼š\nåˆå§‹åŒ–çš„å…¥å£åœ¨å®¹å™¨å®ç°ä¸­çš„refresh()è°ƒç”¨æ¥å®Œæˆ å¯¹beanå®šä¹‰è½½å…¥IoCå®¹å™¨ä½¿ç”¨çš„æ–¹æ³•æ˜¯loadBeanDefinitionï¼Œå…¶ä¸­å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1ã€é€šè¿‡ResourceLoaderæ¥å®Œæˆèµ„æºæ–‡ä»¶ä½ç½®çš„å®šä½ï¼ŒDefaultResourceLoaderæ˜¯é»˜è®¤çš„å®ç°ï¼ŒåŒæ—¶ä¸Šä¸‹æ–‡æœ¬èº«å°±ç»™å‡ºäº†ResourceLoaderçš„å®ç°ï¼Œå¯ä»¥ä»ç±»è·¯å¾„ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼ŒURLç­‰æ–¹å¼æ¥å®šä¹‰ä¸ºèµ„æºä½ç½®ã€‚å¦‚æœæ˜¯XmlBeanFactoryä½œä¸ºIOCå®¹å™¨ï¼Œé‚£ä¹ˆéœ€è¦ä¸ºå®ƒæŒ‡å®šbeanå®šä¹‰çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´beanå®šä¹‰æ–‡ä»¶æ—¶é€šè¿‡æŠ½è±¡æˆResourceæ¥è¢«IOCå®¹å™¨å¤„ç†çš„ã€‚ 2ã€é€šè¿‡BeanDefinitionReaderæ¥å®Œæˆå®šä¹‰ä¿¡æ¯çš„è§£æå’ŒBeanä¿¡æ¯çš„æ³¨å†Œï¼Œå¾€å¾€ä½¿ç”¨çš„æ˜¯XmlBeanDefinitionReaderæ¥è§£æbeançš„xmlå®šä¹‰æ–‡ä»¶-å®é™…çš„å¤„ç†è¿‡ç¨‹æ˜¯å§”æ‰˜ç»™BeanDefinitionParserDelegateæ¥å®Œæˆçš„ï¼Œä»è€Œå¾—åˆ°beançš„å®šä¹‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åœ¨Springä¸­ä½¿ç”¨BeanDefinitionå¯¹è±¡æ¥è¡¨ç¤º-è¿™ä¸ªåå­—å¯ä»¥è®©æˆ‘ä»¬æƒ³åˆ°loadBeanDefinition,RegisterBeanDefinitionè¿™äº›ç›¸å…³æ–¹æ³•-ä»–ä»¬éƒ½æ˜¯ä¸ºå¤„ç†BeanDefinitinæœåŠ¡çš„ã€‚ 3ã€å®¹å™¨è§£æå¾—åˆ°BeanDefinitionä»¥åï¼Œéœ€è¦æŠŠå®ƒåœ¨IOCå®¹å™¨ä¸­æ³¨å†Œï¼Œè¿™ç”±IOCå®ç°BeanDefinitionRegisteræ¥å£æ¥å®ç°ã€‚æ³¨å†Œè¿‡ç¨‹å°±æ˜¯åœ¨IOCå®¹å™¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªHashMapæ¥ä¿å­˜å¾—åˆ°çš„BeanDefinitionçš„è¿‡ç¨‹ã€‚è¿™ä¸ªHashMapæ˜¯IoCå®¹å™¨æŒæœ‰beanä¿¡æ¯çš„åœºæ‰€ï¼Œä»¥åå¯¹beançš„æ“ä½œéƒ½æ˜¯å›´ç»•è¿™ä¸ªHashMapæ¥å®ç°çš„ã€‚\nç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡BeanFactoryå’ŒApplicationCOntextæ¥äº«å—åˆ°SPring IOCçš„æœåŠ¡äº†ï¼Œåœ¨ä½¿ç”¨IoCå®¹å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°é™¤äº†å°‘é‡ç²˜åˆä»£ç ï¼Œç»å¤§å¤šæ•°ä»¥æ­£ç¡®IoCé£æ ¼ç¼–å†™çš„åº”ç”¨ç¨‹åºä»£ç å®Œå…¨ä¸ç”¨å…³å¿ƒå¦‚ä½•åˆ°è¾¾å·¥å‚ï¼Œå› ä¸ºå®¹å™¨å°†æŠŠè¿™äº›å¯¹è±¡ä¸å®¹å™¨ç®¡ç†çš„å…¶ä»–å¯¹è±¡é’©åœ¨ä¸€èµ·ã€‚åŸºæœ¬çš„ç­–ç•¥æ˜¯æŠŠå·¥å‚æ”¾åˆ°å·²çŸ¥çš„åœ°æ–¹ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨å¯¹é¢„æœŸä½¿ç”¨çš„ä¸Šä¸‹æ–‡æœ‰æ„ä¹‰çš„åœ°æ–¹ï¼Œä»¥åŠä»£ç å°†å®é™…éœ€è¦è®¿é—®å·¥å‚çš„åœ°æ–¹ã€‚Springæœ¬èº«æä¾›äº†å¯¹å£°æ˜å¼è½½å…¥Webåº”ç”¨ç¨‹åºç”¨æ³•çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ServletContextä¸­çš„æ¡†æ¶å®ç°ã€‚ Springä¸­getBeançš„ä¸»ä½“æ€è·¯ BeanFactoryå®ç°getBeanæ–¹æ³•åœ¨AbstractBeanFactoryä¸­ï¼Œè¿™ä¸ªæ–¹æ³•é‡è½½éƒ½æ˜¯è°ƒç”¨doGetBeanæ–¹æ³•è¿›è¡Œå®ç°çš„:\n1 2 3 4 5 6 7 8 9 10 11 12 13 public Object getBean(String name) throws BeansException { return doGetBean(name, null, null, false); } public T getBean(String name, Class requiredType) throws BeansException { return doGetBean(name, requiredType, null, false); } public Object getBean(String name, Object... args) throws BeansException { return doGetBean(name, null, args, false); } public T getBean(String name, @Nullable Class requiredType, @Nullable Object... args) throws BeansException { return doGetBean(name, requiredType, args, false); } æ¥ä¸‹æ¥çœ‹ä¸‹doGetBeanæ–¹æ³•(è¿™ä¸ªæ–¹æ³•å¾ˆé•¿ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹å®ƒçš„æ•´ä½“æ€è·¯å’Œè®¾è®¡è¦ç‚¹):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 // å‚æ•°typeCheckOnlyï¼šbeanå®ä¾‹æ˜¯å¦åŒ…å«ä¸€ä¸ªç±»å‹æ£€æŸ¥ protected T doGetBean( String name, @Nullable Class requiredType, @Nullable Object[] args, boolean typeCheckOnly) throws BeansException { // è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ \u0026ï¼Œéœ€è¦å»æ‰ String beanName = transformedBeanName(name); Object beanInstance; // Eagerly check singleton cache for manually registered singletons. Object sharedInstance = getSingleton(beanName); if (sharedInstance != null \u0026\u0026 args == null) { // æ— å‚å•ä¾‹ä»ç¼“å­˜ä¸­è·å– beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, null); } else { // å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ if (isPrototypeCurrentlyInCreation(beanName)) { throw new BeanCurrentlyInCreationException(beanName); } // å¦‚æœ bean definition å­˜åœ¨äºçˆ¶çš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å– BeanFactory parentBeanFactory = getParentBeanFactory(); if (parentBeanFactory != null \u0026\u0026 !containsBeanDefinition(beanName)) { // Not found -\u003e check parent. String nameToLookup = originalBeanName(name); if (parentBeanFactory instanceof AbstractBeanFactory) { return ((AbstractBeanFactory) parentBeanFactory).doGetBean( nameToLookup, requiredType, args, typeCheckOnly); } else if (args != null) { // Delegation to parent with explicit args. return (T) parentBeanFactory.getBean(nameToLookup, args); } else if (requiredType != null) { // No args -\u003e delegate to standard getBean method. return parentBeanFactory.getBean(nameToLookup, requiredType); } else { return (T) parentBeanFactory.getBean(nameToLookup); } } if (!typeCheckOnly) { // å°†å½“å‰beanå®ä¾‹æ”¾å…¥alreadyCreatedé›†åˆé‡Œï¼Œæ ‡è¯†è¿™ä¸ªbeanå‡†å¤‡åˆ›å»ºäº† markBeanAsCreated(beanName); } StartupStep beanCreation = this.applicationStartup.start(\"spring.beans.instantiate\") .tag(\"beanName\", name); try { if (requiredType != null) { beanCreation.tag(\"beanType\", requiredType::toString); } RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName); checkMergedBeanDefinition(mbd, beanName, args); // ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–äº†. String[] dependsOn = mbd.getDependsOn(); if (dependsOn != null) { for (String dep : dependsOn) { if (isDependent(beanName, dep)) { throw new BeanCreationException(mbd.getResourceDescription(), beanName, \"Circular depends-on relationship between '\" + beanName + \"' and '\" + dep + \"'\"); } registerDependentBean(dep, beanName); try { getBean(dep); // åˆå§‹åŒ–å®ƒä¾èµ–çš„Bean } catch (NoSuchBeanDefinitionException ex) { throw new BeanCreationException(mbd.getResourceDescription(), beanName, \"'\" + beanName + \"' depends on missing bean '\" + dep + \"'\", ex); } } } // åˆ›å»ºBeanå®ä¾‹ï¼šå•ä¾‹ if (mbd.isSingleton()) { sharedInstance = getSingleton(beanName, () -\u003e { try { // çœŸæ­£åˆ›å»ºbeançš„æ–¹æ³• return createBean(beanName, mbd, args); } catch (BeansException ex) { // Explicitly remove instance from singleton cache: It might have been put there // eagerly by the creation process, to allow for circular reference resolution. // Also remove any beans that received a temporary reference to the bean. destroySingleton(beanName); throw ex; } }); beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd); } // åˆ›å»ºBeanå®ä¾‹ï¼šåŸå‹ else if (mbd.isPrototype()) { // It's a prototype -\u003e create a new instance. Object prototypeInstance = null; try { beforePrototypeCreation(beanName); prototypeInstance = createBean(beanName, mbd, args); } finally { afterPrototypeCreation(beanName); } beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd); } // åˆ›å»ºBeanå®ä¾‹ï¼šæ ¹æ®beançš„scopeåˆ›å»º else { String scopeName = mbd.getScope(); if (!StringUtils.hasLength(scopeName)) { throw new IllegalStateException(\"No scope name defined for bean Â´\" + beanName + \"'\"); } Scope scope = this.scopes.get(scopeName); if (scope == null) { throw new IllegalStateException(\"No Scope registered for scope name '\" + scopeName + \"'\"); } try { Object scopedInstance = scope.get(beanName, () -\u003e { beforePrototypeCreation(beanName); try { return createBean(beanName, mbd, args); } finally { afterPrototypeCreation(beanName); } }); beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd); } catch (IllegalStateException ex) { throw new ScopeNotActiveException(beanName, scopeName, ex); } } } catch (BeansException ex) { beanCreation.tag(\"exception\", ex.getClass().toString()); beanCreation.tag(\"message\", String.valueOf(ex.getMessage())); cleanupAfterBeanCreationFailure(beanName); throw ex; } finally { beanCreation.end(); } } return adaptBeanInstance(name, beanInstance, requiredType); } ä¸Šè¿°ä»£ç ä¸»è¦çœ‹ä¸­æ–‡æ³¨é‡Šå³å¯:\nè§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ \u0026ï¼Œéœ€è¦å»æ‰ æ— å‚å•ä¾‹å…ˆä»ç¼“å­˜ä¸­è·å– å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ å¦‚æœbean definitionå­˜åœ¨äºçš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å– æ ‡è®°è¿™ä¸ªbeanNameçš„å®ä¾‹æ­£åœ¨åˆ›å»º ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ– çœŸæ­£åˆ›å»º:\n1. å•ä¾‹æ—¶\n2. åŸå‹æ—¶\n3. æ ¹æ®beançš„scopeåˆ›å»º é‡ç‚¹: SPringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ é¦–å…ˆæˆ‘ä»¬éœ€è¦å£°æ˜ï¼ŒSpringåªæ˜¯è§£å†³äº†å•ä¾‹æ¨¡å¼ä¸‹å±æ€§ä¾èµ–çš„å¾ªç¯é—®é¢˜ï¼›Springä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚\nSpringå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ– å…ˆæ¥çœ‹ä¸‹è¿™ä¸‰çº§ç¼“å­˜\n1 2 3 4 5 6 7 8 /** Cache of singleton objects: bean name --\u003e bean instance */ private final Map singletonObjects = new ConcurrentHashMap(256); /** Cache of early singleton objects: bean name --\u003e bean instance */ private final Map earlySingletonObjects = new HashMap(16); /** Cache of singleton factories: bean name --\u003e ObjectFactory */ private final Map",
  "wordCount" : "15112",
  "inLanguage": "zh",
  "datePublished": "2024-04-12T21:13:28+08:00",
  "dateModified": "2024-04-12T21:13:28+08:00",
  "author":[{
    "@type": "Person",
    "name": "ShengQian"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://csqread.top/posts/tech/%E9%98%85%E8%AF%BBspring%E6%BA%90%E7%A0%81/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Qian's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://csqread.top/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://csqread.top" accesskey="h" title="Qian&#39;s Blog (Alt + H)">
                <img src="https://csqread.top/img/%21.jpg" alt="" aria-label="logo"
                    height="35">Qian&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://csqread.top/search" title="ğŸ”æœç´¢">
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/tags" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://csqread.top/links" title="ğŸ¤å‹é“¾">
                    <span>ğŸ¤å‹é“¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://csqread.top">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://csqread.top/posts/">Posts</a>&nbsp;Â»&nbsp;<a href="https://csqread.top/posts/tech/">æŠ€æœ¯</a></div>
    <h1 class="post-title">
      é˜…è¯»Springæºç 
    </h1>
    <div class="post-meta">










åˆ›å»º:&nbsp;<span title='2024-04-12 21:13:28 +0800 CST'>2024-04-12</span>&nbsp;|&nbsp;æ›´æ–°:&nbsp;2024-04-12&nbsp;|&nbsp;å­—æ•°:&nbsp;15112å­—&nbsp;|&nbsp;æ—¶é•¿: 31åˆ†é’Ÿ&nbsp;|&nbsp;
ä½œè€…:&nbsp;ShengQian


    &nbsp;|&nbsp;æ ‡ç­¾: &nbsp;
    <ul class="post-tags-meta">
        <a href="https://csqread.top/tags/spring/">spring</a>
    </ul>

    
    
    
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_page_pv">
        &nbsp;| è®¿é—®: <span id="busuanzi_value_page_pv"></span>
    </span>

    
    
    
    
    <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js">
    </script>
    <script>
        let url = document.documentURI
        
        let dnsUrl = "https://csqread.top"
        let urlSplit = url.split(dnsUrl)
        let finalUrl = urlSplit[1]
        if (finalUrl[0] !== '/') {
            finalUrl = '/'+finalUrl
        }
        twikoo.getCommentsCount({
            envId:  null ,
            region:  null ,
            urls: [
                finalUrl,
            ],
            includeReply: false 
        }).then(function (res) {
            let count = res[0].count
            const obj = document.getElementById("comment_count");
            obj.innerText = count
            
            
            
        }).catch(function (err) {
            
            console.error(err);
        });
    </script>
    &nbsp;| è¯„è®º: &nbsp; <span id="comment_count"></span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#spring" aria-label="Spring">Spring</a><ul>
                            
                    <li>
                        <a href="#%e4%bb%80%e4%b9%88%e6%98%afspring%e6%a1%86%e6%9e%b6" aria-label="ä»€ä¹ˆæ˜¯Springæ¡†æ¶">ä»€ä¹ˆæ˜¯Springæ¡†æ¶</a></li>
                    <li>
                        <a href="#spring%e4%b8%ad%e7%9a%84%e5%8d%95%e4%be%8bbean%e7%9a%84%e7%ba%bf%e7%a8%8b%e5%ae%89%e5%85%a8%e9%97%ae%e9%a2%98%e4%ba%86%e8%a7%a3%e5%90%97" aria-label="Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ">Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ</a></li>
                    <li>
                        <a href="#spring%e4%b8%ad%e7%9a%84bean%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" aria-label="Springä¸­çš„beanç”Ÿå‘½å‘¨æœŸï¼Ÿ">Springä¸­çš„beanç”Ÿå‘½å‘¨æœŸï¼Ÿ</a></li>
                    <li>
                        <a href="#%e5%a6%82%e4%bd%95%e5%b0%86bean%e4%bb%8exml%e9%85%8d%e7%bd%ae%e4%b8%ad%e8%a7%a3%e6%9e%90%e5%90%8e%e6%94%be%e5%88%b0ioc%e5%ae%b9%e5%99%a8%e4%b8%ad%e5%be%97" aria-label="å¦‚ä½•å°†Beanä»XMLé…ç½®ä¸­è§£æåæ”¾åˆ°IoCå®¹å™¨ä¸­å¾—ï¼Ÿ">å¦‚ä½•å°†Beanä»XMLé…ç½®ä¸­è§£æåæ”¾åˆ°IoCå®¹å™¨ä¸­å¾—ï¼Ÿ</a></li>
                    <li>
                        <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e7%9a%84%e5%85%a5%e5%8f%a3" aria-label="åˆå§‹åŒ–çš„å…¥å£">åˆå§‹åŒ–çš„å…¥å£</a></li>
                    <li>
                        <a href="#%e8%ae%be%e7%bd%ae%e8%b5%84%e6%ba%90%e8%a7%a3%e6%9e%90%e5%99%a8%e5%92%8c%e7%8e%af%e5%a2%83" aria-label="è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ">è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ</a></li>
                    <li>
                        <a href="#%e8%ae%be%e7%bd%ae%e9%85%8d%e7%bd%ae%e8%b7%af%e5%be%84" aria-label="è®¾ç½®é…ç½®è·¯å¾„">è®¾ç½®é…ç½®è·¯å¾„</a></li>
                    <li>
                        <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96%e7%9a%84%e4%b8%bb%e4%bd%93%e6%b5%81%e7%a8%8b" aria-label="åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹">åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹</a></li>
                    <li>
                        <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96beanfactory%e4%b9%8bobtainfreshbeanfactory" aria-label="åˆå§‹åŒ–BeanFactoryä¹‹obtainFreshBeanFactory">åˆå§‹åŒ–BeanFactoryä¹‹obtainFreshBeanFactory</a></li>
                    <li>
                        <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96beanfactory%e4%b9%8bloadbeandefinitions" aria-label="åˆå§‹åŒ–BeanFactoryä¹‹loadBeanDefinitions">åˆå§‹åŒ–BeanFactoryä¹‹loadBeanDefinitions</a></li>
                    <li>
                        <a href="#abstractbeandefinitionreader%e8%af%bb%e5%8f%96bean%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90" aria-label="AbstractBeanDefinitionReaderè¯»å–Beanå®šä¹‰èµ„æº">AbstractBeanDefinitionReaderè¯»å–Beanå®šä¹‰èµ„æº</a></li>
                    <li>
                        <a href="#xmlbeandefinitionreader%e5%8a%a0%e8%bd%bdbean%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90" aria-label="XmlBeanDefinitionReaderåŠ è½½Beanå®šä¹‰èµ„æº">XmlBeanDefinitionReaderåŠ è½½Beanå®šä¹‰èµ„æº</a></li>
                    <li>
                        <a href="#documentloader%e5%b0%86bean%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90%e8%bd%ac%e6%8d%a2%e4%b8%badocument%e5%af%b9%e8%b1%a1" aria-label="DocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡">DocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡</a></li>
                    <li>
                        <a href="#xmlbeandefinitionreader%e8%a7%a3%e6%9e%90%e8%bd%bd%e5%85%a5%e7%9a%84bean%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6" aria-label="XmlBeanDefinitionReaderè§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶">XmlBeanDefinitionReaderè§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶</a></li>
                    <li>
                        <a href="#defaultbeandefinitiondocumentreader%e5%af%b9bean%e5%ae%9a%e4%b9%89%e7%9a%84document%e5%af%b9%e8%b1%a1%e8%a7%a3%e6%9e%90" aria-label="DefaultBeanDefinitionDocumentReaderå¯¹beanå®šä¹‰çš„Documentå¯¹è±¡è§£æ">DefaultBeanDefinitionDocumentReaderå¯¹beanå®šä¹‰çš„Documentå¯¹è±¡è§£æ</a></li>
                    <li>
                        <a href="#beandefinitionparserdelegate-%e8%a7%a3%e6%9e%90bean%e5%ae%9a%e4%b9%89%e8%b5%84%e6%ba%90%e6%96%87%e4%bb%b6%e7%94%9f%e6%88%90beandefinition" aria-label="BeanDefinitionParserDelegate è§£æBeanå®šä¹‰èµ„æºæ–‡ä»¶ç”ŸæˆBeanDefinition">BeanDefinitionParserDelegate è§£æBeanå®šä¹‰èµ„æºæ–‡ä»¶ç”ŸæˆBeanDefinition</a></li>
                    <li>
                        <a href="#%e8%a7%a3%e6%9e%90%e8%bf%87%e5%90%8e%e7%9a%84beandefinition%e5%9c%a8ioc%e5%ae%b9%e5%99%a8%e4%b8%ad%e6%b3%a8%e5%86%8c" aria-label="è§£æè¿‡åçš„BeanDefinitionåœ¨IoCå®¹å™¨ä¸­æ³¨å†Œ">è§£æè¿‡åçš„BeanDefinitionåœ¨IoCå®¹å™¨ä¸­æ³¨å†Œ</a></li>
                    <li>
                        <a href="#defaultlistablebeanfactory-%e5%90%91ioc%e5%ae%b9%e5%99%a8%e6%b3%a8%e5%86%8c%e8%a7%a3%e6%9e%90%e5%90%8e%e7%9a%84beandefinition" aria-label="DefaultListableBeanFactory å‘IoCå®¹å™¨æ³¨å†Œè§£æåçš„BeanDefinition">DefaultListableBeanFactory å‘IoCå®¹å™¨æ³¨å†Œè§£æåçš„BeanDefinition</a></li>
                    <li>
                        <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a></li>
                    <li>
                        <a href="#spring%e4%b8%adgetbean%e7%9a%84%e4%b8%bb%e4%bd%93%e6%80%9d%e8%b7%af" aria-label="Springä¸­getBeançš„ä¸»ä½“æ€è·¯">Springä¸­getBeançš„ä¸»ä½“æ€è·¯</a></li>
                    <li>
                        <a href="#%e9%87%8d%e7%82%b9-spring%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96%e9%97%ae%e9%a2%98" aria-label="é‡ç‚¹: SPringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜">é‡ç‚¹: SPringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜</a></li>
                    <li>
                        <a href="#spring%e5%8d%95%e4%be%8b%e6%a8%a1%e5%bc%8f%e4%b8%8b%e7%9a%84%e5%b1%9e%e6%80%a7%e4%be%9d%e8%b5%96" aria-label="Springå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ–">Springå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ–</a></li>
                    <li>
                        <a href="#spring%e4%b8%ba%e4%bd%95%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3%e9%9d%9e%e5%8d%95%e4%be%8b%e5%b1%9e%e6%80%a7%e4%b9%8b%e5%a4%96%e7%9a%84%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96" aria-label="Springä¸ºä½•ä¸èƒ½è§£å†³éå•ä¾‹å±æ€§ä¹‹å¤–çš„å¾ªç¯ä¾èµ–ï¼Ÿ">Springä¸ºä½•ä¸èƒ½è§£å†³éå•ä¾‹å±æ€§ä¹‹å¤–çš„å¾ªç¯ä¾èµ–ï¼Ÿ</a><ul>
                            
                    <li>
                        <a href="#spring%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3%e6%9e%84%e9%80%a0%e5%99%a8%e7%9a%84%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96" aria-label="Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–</a></li>
                    <li>
                        <a href="#spring%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3prototype%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96" aria-label="Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸå¾ªç¯ä¾èµ–">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸå¾ªç¯ä¾èµ–</a></li>
                    <li>
                        <a href="#spring%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e8%83%bd%e8%a7%a3%e5%86%b3%e5%a4%9a%e4%be%8b%e7%9a%84%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96" aria-label="Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–ï¼Ÿ">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–ï¼Ÿ</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e9%82%a3%e4%b9%88%e5%85%b6%e4%bb%96%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3" aria-label="é‚£ä¹ˆå…¶ä»–å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ">é‚£ä¹ˆå…¶ä»–å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ</a></li>
                    <li>
                        <a href="#%e9%87%8d%e7%82%b9-spring%e4%b8%adbean%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" aria-label="é‡ç‚¹: Springä¸­Beançš„ç”Ÿå‘½å‘¨æœŸ">é‡ç‚¹: Springä¸­Beançš„ç”Ÿå‘½å‘¨æœŸ</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h1 id="spring">Spring<a hidden class="anchor" aria-hidden="true" href="#spring">#</a></h1>
<h2 id="ä»€ä¹ˆæ˜¯springæ¡†æ¶">ä»€ä¹ˆæ˜¯Springæ¡†æ¶<a hidden class="anchor" aria-hidden="true" href="#ä»€ä¹ˆæ˜¯springæ¡†æ¶">#</a></h2>
<p>Springæ˜¯ä¸€ç§è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨æé«˜å¼€å‘äººå‘˜çš„å¼€å‘æ•ˆç‡å’Œç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚
æˆ‘ä»¬ä¸€èˆ¬è¯´çš„Springæ¡†æ¶å°±æ˜¯SPring Frameworkï¼Œä»–æ˜¯å¾ˆå¤šæ¨¡å—çš„é›†åˆï¼Œä½¿ç”¨è¿™äº›æ¨¡å—å¯ä»¥å¾ˆæ–¹ä¾¿çš„ååŠ©æˆ‘ä»¬è¿›è¡Œå¼€å‘ã€‚è¿™äº›æ¨¡å—æ˜¯æ ¸å¿ƒå®¹å™¨ã€æ•°æ®è®¿é—®/é›†æˆã€webã€aopã€å·¥å…·ã€æ¶ˆæ¯å’Œæµ‹è¯•æ¨¡å—ã€‚æ¯”å¦‚Core Containerä¸­çš„Coreç»„ä»¶æ˜¯Springæ‰€æœ‰ç»„ä»¶çš„æ ¸å¿ƒï¼ŒBeansç»„ä»¶å’ŒContextç»„ä»¶æ˜¯å®ç°IOCå’ŒDIçš„åŸºç¡€ï¼ŒAOPç»„ä»¶ç”¨æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p>
<p>Springå®˜ç½‘åˆ—å‡ºæ¥çš„Springçš„6ä¸ªç‰¹å¾:</p>
<li>æ ¸å¿ƒæŠ€æœ¯ï¼šä¾èµ–æ³¨å…¥ï¼Œaopï¼Œäº‹ä»¶ï¼Œèµ„æºï¼Œi18nï¼ŒéªŒè¯ï¼Œæ•°æ®ç»‘å®šï¼Œç±»å‹è½¬æ¢ï¼ŒSpEL</li>
<li>æµ‹è¯•ï¼šæ¨¡æ‹Ÿå¯¹è±¡ï¼ŒTestContextæ¡†æ¶ï¼ŒSPringMVCæµ‹è¯•ï¼ŒWebTestClient</li>
<li>æ•°æ®è®¿é—®:äº‹åŠ¡ï¼ŒDAOæ”¯æŒï¼ŒJDBCï¼ŒORMï¼Œç¼–ç»„XML</li>
<li>Webæ”¯æŒ:Spring MVCå’ŒSPring WebFlux Webæ¡†æ¶</li>
<li>é›†æˆ:è¿œç¨‹å¤„ç†ï¼ŒJMSï¼ŒJCAï¼ŒJMXï¼Œç”µå­é‚®ä»¶ï¼Œä»»åŠ¡ï¼Œè°ƒåº¦ï¼Œç¼“å­˜</li>
<li>è¯­è¨€ï¼šKotlinï¼ŒGroovyï¼ŒåŠ¨æ€è¯­è¨€</li>
<h2 id="springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—">Springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#springä¸­çš„å•ä¾‹beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—">#</a></h2>
<p>å¤§éƒ¨åˆ†æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹beanå­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è¿™ä¸ªå¯¹è±¡çš„éé™æ€æˆå‘˜å˜é‡çš„å†™æ“ä½œä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>æœ‰ä¸¤ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
1ã€åœ¨beanå¯¹è±¡ä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ã€‚
2ã€åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜çš„æˆå‘˜å˜é‡ä¿å­˜åœ¨ThreadLocalä¸­ã€‚</p>
<h2 id="springä¸­çš„beanç”Ÿå‘½å‘¨æœŸ">Springä¸­çš„beanç”Ÿå‘½å‘¨æœŸï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#springä¸­çš„beanç”Ÿå‘½å‘¨æœŸ">#</a></h2>
<p>Beançš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç»å†äº†å„ç§æ–¹æ³•è°ƒç”¨ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<li>Beanè‡ªèº«çš„æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†Beanæœ¬èº«è°ƒç”¨çš„æ–¹æ³•å’Œé€šè¿‡é…ç½®æ–‡ä»¶ä¸­<bean>çš„init-methodå’Œdestroy-methodæŒ‡å®šçš„æ–¹æ³•</li>
<li>Beançº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†BeanNameAwareã€BeanFactoryAwareã€ApplicationContext;å½“ç„¶ä¹ŸåŒ…æ‹¬InitializingBeanå’ŒDiposableBeanè¿™äº›æ¥å£çš„æ–¹æ³•</li>
<li>å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†InstantiationAwareBeanPostProcessorå’ŒBeanPostProcessorè¿™ä¸¤ä¸ªæ¥å£å®ç°ï¼Œä¸€èˆ¬ç§°å®ƒä»¬çš„å®ç°ç±»ä¸ºâ€œåå¤„ç†å™¨â€</li>
<li>å·¥å‚åå¤„ç†å™¨æ¥å£æ–¹æ³•ï¼šè¿™ä¸ªåŒ…æ‹¬äº†AspectJWeavingEnabler,ConfigurationClassPostProcessor,CustomAutowireConfigurerç­‰ç­‰éå¸¸æœ‰ç”¨çš„å·¥å‚åå¤„ç†æ¥å£çš„æ–¹æ³•ã€‚å·¥å‚åå¤„ç†å™¨ä¹Ÿæ˜¯å®¹å™¨çº§çš„ã€‚åœ¨åº”ç”¨ä¸Šä¸‹æ–‡è£…é…é…ç½®æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨ã€‚</li>
<h2 id="å¦‚ä½•å°†beanä»xmlé…ç½®ä¸­è§£æåæ”¾åˆ°iocå®¹å™¨ä¸­å¾—">å¦‚ä½•å°†Beanä»XMLé…ç½®ä¸­è§£æåæ”¾åˆ°IoCå®¹å™¨ä¸­å¾—ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å°†beanä»xmlé…ç½®ä¸­è§£æåæ”¾åˆ°iocå®¹å™¨ä¸­å¾—">#</a></h2>
<h2 id="åˆå§‹åŒ–çš„å…¥å£">åˆå§‹åŒ–çš„å…¥å£<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–çš„å…¥å£">#</a></h2>
<p>å¯¹äºxmlé…ç½®çš„Springåº”ç”¨ï¼Œåœ¨main()æ–¹æ³•ä¸­å®ä¾‹åŒ–ClasspathXmlApplicationå³å¯åˆ›å»ºä¸€ä¸ªIoCå®¹å™¨ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªæ„é€ æ–¹æ³•å¼€å§‹ï¼Œæ¢ç©¶ä¸€ä¸‹IoCå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#007f7f">// create and configure beans
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ApplicationContext context = <span style="color:#fff;font-weight:bold">new</span> ClassPathXmlApplicationContext(<span style="color:#0ff;font-weight:bold">&#34;aspects.xml&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;daos.xml&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;services.xml&#34;</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ClassPathXmlApplicationContext(String... configLocations) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>(configLocations, <span style="color:#fff;font-weight:bold">true</span>, (ApplicationContext)<span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> ClassPathXmlApplicationContext(String[] configLocations, <span style="color:#fff;font-weight:bold">boolean</span> refresh, @Nullable ApplicationContext parent) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®Beanèµ„æºåŠ è½½å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">super</span>(parent);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®é…ç½®è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">setConfigLocations</span>(configLocations);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆå§‹åŒ–å®¹å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (refresh) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">refresh</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ">è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#è®¾ç½®èµ„æºè§£æå™¨å’Œç¯å¢ƒ">#</a></h2>
<p>è°ƒç”¨çˆ¶ç±»å®¹å™¨AbstractApplicationContextçš„æ„é€ æ–¹æ³•(super(parent)æ–¹æ³•)ä¸ºå®¹å™¨è®¾ç½®å¥½Beanèµ„æºåŠ è½½å™¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> AbstractApplicationContext(@Nullable ApplicationContext parent) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// é»˜è®¤æ„é€ å‡½æ•°åˆå§‹åŒ–å®¹å™¨id, name, çŠ¶æ€ ä»¥åŠ èµ„æºè§£æå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å°†çˆ¶å®¹å™¨çš„Environmentåˆå¹¶åˆ°å½“å‰å®¹å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">setParent</span>(parent);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡AbstractApplicationContexté»˜è®¤æ„é€ å™¨åˆå§‹åŒ–å®¹å™¨id,name,çŠ¶æ€ä»¥åŠèµ„æºè§£æå™¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> AbstractApplicationContext() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">logger</span> = LogFactory.<span style="color:#007f7f">getLog</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getClass</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">id</span> = ObjectUtils.<span style="color:#007f7f">identityToString</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">displayName</span> = ObjectUtils.<span style="color:#007f7f">identityToString</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanFactoryPostProcessors</span> = <span style="color:#fff;font-weight:bold">new</span> ArrayList();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">active</span> = <span style="color:#fff;font-weight:bold">new</span> AtomicBoolean();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">closed</span> = <span style="color:#fff;font-weight:bold">new</span> AtomicBoolean();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">startupShutdownMonitor</span> = <span style="color:#fff;font-weight:bold">new</span> Object();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationStartup</span> = ApplicationStartup.<span style="color:#007f7f">DEFAULT</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationListeners</span> = <span style="color:#fff;font-weight:bold">new</span> LinkedHashSet();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">resourcePatternResolver</span> = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getResourcePatternResolver</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// Springèµ„æºåŠ è½½å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> ResourcePatternResolver getResourcePatternResolver() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> PathMatchingResourcePatternResolver(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡AbstractApplicationContextçš„setParent(parent)æ–¹æ³•å°†çˆ¶å®¹å™¨çš„Enviromentåˆå¹¶åˆ°å½“å‰å®¹å™¨</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setParent(@Nullable ApplicationContext parent) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">parent</span> = parent;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (parent != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        Environment parentEnvironment = parent.<span style="color:#007f7f">getEnvironment</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (parentEnvironment <span style="color:#fff;font-weight:bold">instanceof</span> ConfigurableEnvironment) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getEnvironment</span>().<span style="color:#007f7f">merge</span>((ConfigurableEnvironment)parentEnvironment);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è®¾ç½®é…ç½®è·¯å¾„">è®¾ç½®é…ç½®è·¯å¾„<a hidden class="anchor" aria-hidden="true" href="#è®¾ç½®é…ç½®è·¯å¾„">#</a></h2>
<p>åœ¨è®¾ç½®å®¹å™¨çš„èµ„æºåŠ è½½å™¨ä¹‹åï¼Œæ¥ä¸‹æ¥FileSystemXmlApplicationContentæ‰§è¡ŒsetConfigLocationsæ–¹æ³•é€šè¿‡è°ƒç”¨å…¶çˆ¶ç±»AbstractRefreshableConfigApplicationContextçš„æ–¹æ³•è¿›è¡Œå¯¹Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„å®šä½ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> setConfigLocations(@Nullable String... locations) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (locations != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        Assert.<span style="color:#007f7f">noNullElements</span>(locations, <span style="color:#0ff;font-weight:bold">&#34;Config locations must not be null&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">configLocations</span> = <span style="color:#fff;font-weight:bold">new</span> String[locations.<span style="color:#007f7f">length</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span>(<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; locations.<span style="color:#007f7f">length</span>; ++i) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è§£æé…ç½®è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">configLocations</span>[i] = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">resolvePath</span>(locations[i]).<span style="color:#007f7f">trim</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">configLocations</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> String resolvePath(String path) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// ä»ä¸Šä¸€æ­¥Environmentä¸­è§£æ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getEnvironment</span>().<span style="color:#007f7f">resolveRequiredPlaceholders</span>(path);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹">åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–çš„ä¸»ä½“æµç¨‹">#</a></h2>
<p>Spring IoCå®¹å™¨å¯¹Beanå®šä¹‰èµ„æºçš„åŠ è½½æ˜¯ä»refresh()å‡½æ•°å¼€å§‹çš„ï¼Œrefresh()æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œrefresh()æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šåœ¨åˆ›å»ºIoCå®¹å™¨å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refresh()ä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚refreshçš„ä½œç”¨ç±»ä¼¼äºå¯¹IoCå®¹å™¨çš„é‡å¯ï¼Œåœ¨æ–°å»ºç«‹å¥½çš„å®¹å™¨ä¸­å¯¹å®¹å™¨è¿›è¡Œåˆå§‹åŒ–ï¼Œå¯¹Beanå®šä¹‰èµ„æºè¿›è¡Œè½½å…¥ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> refresh() <span style="color:#fff;font-weight:bold">throws</span> BeansException, IllegalStateException {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">startupShutdownMonitor</span>) {
</span></span><span style="display:flex;"><span>        StartupStep contextRefresh = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationStartup</span>.<span style="color:#007f7f">start</span>(<span style="color:#0ff;font-weight:bold">&#34;spring.context.refresh&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Prepare this context for refreshing.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        prepareRefresh();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Tell the subclass to refresh the internal bean factory.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Prepare the bean factory for use in this context.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        prepareBeanFactory(beanFactory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Allows post-processing of the bean factory in context subclasses.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            postProcessBeanFactory(beanFactory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            StartupStep beanPostProcess = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationStartup</span>.<span style="color:#007f7f">start</span>(<span style="color:#0ff;font-weight:bold">&#34;spring.context.beans.post-process&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Invoke factory processors registered as beans in the context.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            invokeBeanFactoryPostProcessors(beanFactory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Register bean processors that intercept bean creation.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            registerBeanPostProcessors(beanFactory);
</span></span><span style="display:flex;"><span>            beanPostProcess.<span style="color:#007f7f">end</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Initialize message source for this context.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            initMessageSource();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Initialize event multicaster for this context.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            initApplicationEventMulticaster();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Initialize other special beans in specific context subclasses.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            onRefresh();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Check for listener beans and register them.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            registerListeners();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Instantiate all remaining (non-lazy-init) singletons.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            finishBeanFactoryInitialization(beanFactory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Last step: publish corresponding event.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            finishRefresh();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">catch</span> (BeansException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isWarnEnabled</span>()) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#007f7f">warn</span>(<span style="color:#0ff;font-weight:bold">&#34;Exception encountered during context initialization - &#34;</span> +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;cancelling refresh attempt: &#34;</span> + ex);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Destroy already created singletons to avoid dangling resources.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            destroyBeans();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Reset &#39;active&#39; flag.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            cancelRefresh(ex);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Propagate exception to caller.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">throw</span> ex;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Reset common introspection caches in Spring&#39;s core, since we
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// might not ever need metadata for singleton beans anymore...
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            resetCommonCaches();
</span></span><span style="display:flex;"><span>            contextRefresh.<span style="color:#007f7f">end</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><b>è¿™é‡Œçš„è®¾è®¡ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„èµ„æºç±»åŠ è½½å¤„ç†å‹çš„æ€è·¯</b></p>
<li>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œæ¨¡æ¿æ–¹æ³•ä¸­ä½¿ç”¨å…¸å‹çš„é’©å­æ–¹æ³•</li>
<li>å°†å…·ä½“çš„åˆå§‹åŒ–åŠ è½½æ–¹æ³•æ’å…¥åˆ°é’©å­æ–¹æ³•ä¹‹é—´</li>
<li>å°†åˆå§‹åŒ–çš„é˜¶æ®µå°è£…ï¼Œç”¨æ¥è®°å½•å½“å‰åˆå§‹åŒ–åˆ°ä»€ä¹ˆé˜¶æ®µï¼›å¸¸è§çš„è®¾è®¡æ˜¯xxxPhase/xxxStage</li>
<li>èµ„æºåŠ è½½åˆå§‹åŒ–æœ‰å¤±è´¥ç­‰å¤„ç†ï¼Œå¿…ç„¶æ˜¯try/catch/finally</li>
<h2 id="åˆå§‹åŒ–beanfactoryä¹‹obtainfreshbeanfactory">åˆå§‹åŒ–BeanFactoryä¹‹obtainFreshBeanFactory<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–beanfactoryä¹‹obtainfreshbeanfactory">#</a></h2>
<p>AbstractApplicationContextçš„obtainFreshBeanFactory()æ–¹æ³•è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•ï¼Œå¯åŠ¨å®¹å™¨è½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> ConfigurableListableBeanFactory obtainFreshBeanFactory() {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è¿™é‡Œä½¿ç”¨äº†å§”æ´¾è®¾è®¡æ¨¡å¼ï¼Œçˆ¶ç±»å®šä¹‰äº†æŠ½è±¡çš„refreshBeanFactory()æ–¹æ³•ï¼Œå…·ä½“å®ç°è°ƒç”¨å­ç±»å®¹å™¨çš„refreshBeanFactory()æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    refreshBeanFactory();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> getBeanFactory();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>AbstractApplicationCOntextç±»ä¸­åªæŠ½è±¡å®šä¹‰äº†refreshBeanFactory()æ–¹æ³•ï¼Œå®¹å™¨çœŸæ­£è°ƒç”¨çš„æ˜¯å­ç±»çš„AbstractRefreshableApplicationContextå®ç°çš„refreshBeanFactoryï¼ˆï¼‰æ–¹æ³•ç•™åœ¨åˆ›å»ºIoCå®¹å™¨ä¹‹å‰ï¼Œå¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨ã€‚æ–¹æ³•æºç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">void</span> refreshBeanFactory() <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå·²ç»æœ‰å®¹å™¨å­˜åœ¨ï¼Œåˆ™éœ€è¦æŠŠå·²æœ‰çš„å®¹å™¨é”€æ¯å’Œå…³é—­ï¼Œä»¥ä¿è¯åœ¨refreshä¹‹åä½¿ç”¨çš„æ˜¯æ–°å»ºç«‹èµ·æ¥çš„IoCå®¹å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (hasBeanFactory()) {
</span></span><span style="display:flex;"><span>        destroyBeans();
</span></span><span style="display:flex;"><span>        closeBeanFactory();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åˆ›å»ºDefaultListableBeanFactoryï¼Œå¹¶è°ƒç”¨loadBeanDefinitions(beanFactory)è£…è½½beanå®šä¹‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        DefaultListableBeanFactory beanFactory = createBeanFactory();
</span></span><span style="display:flex;"><span>        beanFactory.<span style="color:#007f7f">setSerializationId</span>(getId());
</span></span><span style="display:flex;"><span>        customizeBeanFactory(beanFactory); <span style="color:#007f7f">// å¯¹IoCå®¹å™¨è¿›è¡Œå®šåˆ¶åŒ–ï¼Œå¦‚è®¾ç½®å¯åŠ¨å‚æ•°ï¼Œå¼€å¯æ³¨è§£çš„è‡ªåŠ¨è£…é…ç­‰ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        loadBeanDefinitions(beanFactory); <span style="color:#007f7f">// è°ƒç”¨è½½å…¥Beanå®šä¹‰çš„æ–¹æ³•ï¼Œä¸»è¦è¿™é‡Œåˆä½¿ç”¨äº†ä¸€ä¸ªå§”æ´¾æ¨¡å¼ï¼Œåœ¨å½“å‰ç±»ä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå…·ä½“çš„å®ç°è°ƒç”¨å­ç±»å®¹å™¨  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanFactory</span> = beanFactory;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (IOException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> ApplicationContextException(<span style="color:#0ff;font-weight:bold">&#34;I/O error parsing bean definition source for &#34;</span> + getDisplayName(), ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆå§‹åŒ–beanfactoryä¹‹loadbeandefinitions">åˆå§‹åŒ–BeanFactoryä¹‹loadBeanDefinitions<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–beanfactoryä¹‹loadbeandefinitions">#</a></h2>
<p>AbstractRefreshableApplicationContextä¸­åªå®šä¹‰äº†æŠ½è±¡çš„loadBeanDefinitionsæ–¹æ³•ï¼Œå®¹å™¨çœŸæ­£è°ƒç”¨çš„æ˜¯å…¶å­ç±»çš„AbstractXmlApplicationContextå¯¹è¯¥æ–¹æ³•çš„å®ç°ï¼ŒAbstractXmlApplicationContextçš„ä¸»è¦æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> loadBeanDefinitions(DefaultListableBeanFactory beanFactory) <span style="color:#fff;font-weight:bold">throws</span> BeansException, IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºXmlBeanDefinitionReaderï¼Œå³åˆ›å»ºBeanè¯»å–å™¨ï¼Œå¹¶é€šè¿‡å›è°ƒè®¾ç½®åˆ°å®¹å™¨ä¸­å»ï¼Œå®¹å™¨ä½¿ç”¨è¯¥è¯»å–å™¨è¯»å–Beanå®šä¹‰èµ„æº  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    XmlBeanDefinitionReader beanDefinitionReader = <span style="color:#fff;font-weight:bold">new</span> XmlBeanDefinitionReader(beanFactory);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// é…ç½®ä¸Šä¸‹æ–‡çš„ç¯å¢ƒï¼Œèµ„æºåŠ è½½å™¨ã€è§£æå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    beanDefinitionReader.<span style="color:#007f7f">setEnvironment</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">getEnvironment</span>());
</span></span><span style="display:flex;"><span>    beanDefinitionReader.<span style="color:#007f7f">setResourceLoader</span>(<span style="color:#fff;font-weight:bold">this</span>);
</span></span><span style="display:flex;"><span>    beanDefinitionReader.<span style="color:#007f7f">setEntityResolver</span>(<span style="color:#fff;font-weight:bold">new</span> ResourceEntityResolver(<span style="color:#fff;font-weight:bold">this</span>)); <span style="color:#007f7f">// ä¸ºBeanè¯»å–å™¨è®¾ç½®SAX xmlè§£æå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å…è®¸å­ç±»è‡ªè¡Œåˆå§‹åŒ–ï¼ˆæ¯”å¦‚æ ¡éªŒæœºåˆ¶ï¼‰ï¼Œå¹¶æä¾›çœŸæ­£çš„åŠ è½½æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    initBeanDefinitionReader(beanDefinitionReader); <span style="color:#007f7f">// å½“Beanè¯»å–å™¨è¯»å–Beanå®šä¹‰çš„Xmlèµ„æºæ–‡ä»¶æ—¶ï¼Œå¯ç”¨Xmlçš„æ ¡éªŒæœºåˆ¶  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    loadBeanDefinitions(beanDefinitionReader);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> loadBeanDefinitions(XmlBeanDefinitionReader reader) <span style="color:#fff;font-weight:bold">throws</span> BeansException, IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åŠ è½½XMLé…ç½®æ–¹å¼é‡Œçš„Beanå®šä¹‰çš„èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    Resource[] configResources = getConfigResources();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (configResources != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        reader.<span style="color:#007f7f">loadBeanDefinitions</span>(configResources);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åŠ è½½æ„é€ å‡½æ•°é‡Œé…ç½®çš„Beané…ç½®æ–‡ä»¶ï¼Œå³{&#34;aspects.xml&#34;, &#34;daos.xml&#34;, &#34;services.xml&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    String[] configLocations = getConfigLocations();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (configLocations != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        reader.<span style="color:#007f7f">loadBeanDefinitions</span>(configLocations);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Xml Beanè¯»å–å™¨(XmBeanDefinitionReader)è°ƒç”¨å…¶çˆ¶ç±»AbstractBeanDefinitionReaderçš„reader.loadBeanDefinitionsæ–¹æ³•è¯»å–beanå®šä¹‰èµ„æº</p>
<p>ç”±äºæˆ‘ä»¬ä½¿ç”¨ClassPathXmlApplicationCOntextä½œä¸ºä¾‹å­åˆ†æï¼Œå› æ­¤getConfigResourcesçš„è¿”å›å€¼ä¸ºnullï¼Œå› æ­¤ç¨‹åºæ‰§è¡Œreader,loadBeanDefinitions(configLocations)åˆ†æ”¯ã€‚</p>
<h2 id="abstractbeandefinitionreaderè¯»å–beanå®šä¹‰èµ„æº">AbstractBeanDefinitionReaderè¯»å–Beanå®šä¹‰èµ„æº<a hidden class="anchor" aria-hidden="true" href="#abstractbeandefinitionreaderè¯»å–beanå®šä¹‰èµ„æº">#</a></h2>
<p>AbstractBeanDifinitionReaderçš„loadBeanDefinitionsæ–¹æ³•æºç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> loadBeanDefinitions(String location) <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> loadBeanDefinitions(location, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> loadBeanDefinitions(String location, @Nullable Set&lt;Resource&gt; actualResources) <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>    ResourceLoader resourceLoader = getResourceLoader();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (resourceLoader == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;Cannot load bean definitions from location [&#34;</span> + location + <span style="color:#0ff;font-weight:bold">&#34;]: no ResourceLoader available&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ¨¡å¼åŒ¹é…ç±»å‹çš„è§£æå™¨ï¼Œè¿™ç§æ–¹å¼æ˜¯åŠ è½½å¤šä¸ªæ»¡è¶³åŒ¹é…æ¡ä»¶çš„èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (resourceLoader <span style="color:#fff;font-weight:bold">instanceof</span> ResourcePatternResolver) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// è·å–åˆ°è¦åŠ è½½çš„èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            Resource[] resources = ((ResourcePatternResolver) resourceLoader).<span style="color:#007f7f">getResources</span>(location);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">int</span> count = loadBeanDefinitions(resources); <span style="color:#007f7f">// å§”æ´¾è°ƒç”¨å…¶å­ç±»XmlBeanDefinitionReaderçš„æ–¹æ³•ï¼Œå®ç°åŠ è½½åŠŸèƒ½  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (actualResources != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>                Collections.<span style="color:#007f7f">addAll</span>(actualResources, resources);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isTraceEnabled</span>()) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#007f7f">trace</span>(<span style="color:#0ff;font-weight:bold">&#34;Loaded &#34;</span> + count + <span style="color:#0ff;font-weight:bold">&#34; bean definitions from location pattern [&#34;</span> + location + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">catch</span> (IOException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(
</span></span><span style="display:flex;"><span>                    <span style="color:#0ff;font-weight:bold">&#34;Could not resolve bean definition resource pattern [&#34;</span> + location + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>, ex);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// åªèƒ½é€šè¿‡ç»å¯¹è·¯å¾„URLåŠ è½½å•ä¸ªèµ„æº.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Resource resource = resourceLoader.<span style="color:#007f7f">getResource</span>(location);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">int</span> count = loadBeanDefinitions(resource);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (actualResources != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            actualResources.<span style="color:#007f7f">add</span>(resource);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isTraceEnabled</span>()) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#007f7f">trace</span>(<span style="color:#0ff;font-weight:bold">&#34;Loaded &#34;</span> + count + <span style="color:#0ff;font-weight:bold">&#34; bean definitions from location [&#34;</span> + location + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»å¯¹AbstractBeanDefinitionReaderçš„loadBeanDefinitionsæ–¹æ³•æºç åˆ†æå¯ä»¥çœ‹å‡ºè¯¥æ–¹æ³•åšäº†ä»¥ä¸‹ä¸¤ä»¶äº‹:</p>
<p>1ã€é¦–å…ˆï¼Œè°ƒç”¨èµ„æºåŠ è½½å™¨çš„è·å–èµ„æºæ–¹æ³•resourceLoader.getResource(location)ï¼Œè·å–åˆ°è¦åŠ è½½çš„èµ„æºã€‚
2ã€å…¶æ¬¡ï¼ŒçœŸæ­£æ‰§è¡ŒåŠ è½½åŠŸèƒ½çš„æ˜¯å…¶å­ç±»XmlBeanDefinitionReaderçš„loadBeanDefinitionsæ–¹æ³•</p>
<h2 id="xmlbeandefinitionreaderåŠ è½½beanå®šä¹‰èµ„æº">XmlBeanDefinitionReaderåŠ è½½Beanå®šä¹‰èµ„æº<a hidden class="anchor" aria-hidden="true" href="#xmlbeandefinitionreaderåŠ è½½beanå®šä¹‰èµ„æº">#</a></h2>
<p>ç»§ç»­çœ‹å­ç±»XmlBeanDefinitionReaderçš„loadBeanDefinitions(Resource&hellip;)æ–¹æ³•çœ‹åˆ°ä»£è¡¨beanæ–‡ä»¶çš„èµ„æºå®šä¹‰ä»¥åçš„è½½å…¥è¿‡ç¨‹ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * æœ¬è´¨ä¸Šæ˜¯åŠ è½½XMLé…ç½®çš„Beanã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * @param inputSource the SAX InputSource to read from
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * @param resource the resource descriptor for the XML file
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">int</span> doLoadBeanDefinitions(InputSource inputSource, Resource resource)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        Document doc = doLoadDocument(inputSource, resource); <span style="color:#007f7f">// å°†Beanå®šä¹‰èµ„æºè½¬æ¢æˆDocumentå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">int</span> count = registerBeanDefinitions(doc, resource);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isDebugEnabled</span>()) {
</span></span><span style="display:flex;"><span>            logger.<span style="color:#007f7f">debug</span>(<span style="color:#0ff;font-weight:bold">&#34;Loaded &#34;</span> + count + <span style="color:#0ff;font-weight:bold">&#34; bean definitions from &#34;</span> + resource);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> count;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (BeanDefinitionStoreException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> ex;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (SAXParseException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> XmlBeanDefinitionStoreException(resource.<span style="color:#007f7f">getDescription</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;Line &#34;</span> + ex.<span style="color:#007f7f">getLineNumber</span>() + <span style="color:#0ff;font-weight:bold">&#34; in XML document from &#34;</span> + resource + <span style="color:#0ff;font-weight:bold">&#34; is invalid&#34;</span>, ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (SAXException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> XmlBeanDefinitionStoreException(resource.<span style="color:#007f7f">getDescription</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;XML document from &#34;</span> + resource + <span style="color:#0ff;font-weight:bold">&#34; is invalid&#34;</span>, ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (ParserConfigurationException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(resource.<span style="color:#007f7f">getDescription</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;Parser configuration exception parsing XML from &#34;</span> + resource, ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (IOException ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(resource.<span style="color:#007f7f">getDescription</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;IOException parsing XML document from &#34;</span> + resource, ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (Throwable ex) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(resource.<span style="color:#007f7f">getDescription</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;Unexpected exception parsing XML document from &#34;</span> + resource, ex);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨é…ç½®çš„DocumentLoaderåŠ è½½XMLå®šä¹‰æ–‡ä»¶ä¸ºDocument.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> Document doLoadDocument(InputSource inputSource, Resource resource) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">documentLoader</span>.<span style="color:#007f7f">loadDocument</span>(inputSource, getEntityResolver(), <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">errorHandler</span>,
</span></span><span style="display:flex;"><span>            getValidationModeForResource(resource), isNamespaceAware());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æºç åˆ†æï¼Œè½½å…¥Beanå®šä¹‰èµ„æºæ–‡ä»¶çš„æœ€åä¸€æ­¥æ˜¯å°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼Œè¯¥è¿‡ç¨‹ç”±documentLoaderå®ç°</p>
<h2 id="documentloaderå°†beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºdocumentå¯¹è±¡">DocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡<a hidden class="anchor" aria-hidden="true" href="#documentloaderå°†beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºdocumentå¯¹è±¡">#</a></h2>
<p>DocumentLoaderå°†Beanå®šä¹‰èµ„æºè½¬æ¢ä¸ºDocumentå¯¹è±¡çš„æºç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// ä½¿ç”¨æ ‡å‡†çš„JAXPå°†è½½å…¥çš„Beanå®šä¹‰èµ„æºè½¬æ¢æˆdocumentå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Document loadDocument(InputSource inputSource, EntityResolver entityResolver,
</span></span><span style="display:flex;"><span>        ErrorHandler errorHandler, <span style="color:#fff;font-weight:bold">int</span> validationMode, <span style="color:#fff;font-weight:bold">boolean</span> namespaceAware) <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºæ–‡ä»¶è§£æå™¨å·¥å‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    DocumentBuilderFactory factory = createDocumentBuilderFactory(validationMode, namespaceAware);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isTraceEnabled</span>()) {
</span></span><span style="display:flex;"><span>        logger.<span style="color:#007f7f">trace</span>(<span style="color:#0ff;font-weight:bold">&#34;Using JAXP provider [&#34;</span> + factory.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">getName</span>() + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// åˆ›å»ºæ–‡æ¡£è§£æå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    DocumentBuilder builder = createDocumentBuilder(factory, entityResolver, errorHandler);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> builder.<span style="color:#007f7f">parse</span>(inputSource); <span style="color:#007f7f">// è§£æ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> DocumentBuilderFactory createDocumentBuilderFactory(<span style="color:#fff;font-weight:bold">int</span> validationMode, <span style="color:#fff;font-weight:bold">boolean</span> namespaceAware)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> ParserConfigurationException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    DocumentBuilderFactory factory = DocumentBuilderFactory.<span style="color:#007f7f">newInstance</span>();
</span></span><span style="display:flex;"><span>    factory.<span style="color:#007f7f">setNamespaceAware</span>(namespaceAware);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è®¾ç½®è§£æXMLçš„æ ¡éªŒ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (validationMode != XmlValidationModeDetector.<span style="color:#007f7f">VALIDATION_NONE</span>) {
</span></span><span style="display:flex;"><span>        factory.<span style="color:#007f7f">setValidating</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (validationMode == XmlValidationModeDetector.<span style="color:#007f7f">VALIDATION_XSD</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Enforce namespace aware for XSD...
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            factory.<span style="color:#007f7f">setNamespaceAware</span>(<span style="color:#fff;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                factory.<span style="color:#007f7f">setAttribute</span>(SCHEMA_LANGUAGE_ATTRIBUTE, XSD_SCHEMA_LANGUAGE);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">catch</span> (IllegalArgumentException ex) {
</span></span><span style="display:flex;"><span>                ParserConfigurationException pcex = <span style="color:#fff;font-weight:bold">new</span> ParserConfigurationException(
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;Unable to validate using XSD: Your JAXP provider [&#34;</span> + factory +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;] does not support XML Schema. Are you running on Java 1.4 with Apache Crimson? &#34;</span> +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;Upgrade to Apache Xerces (or Java 1.5) for full XSD support.&#34;</span>);
</span></span><span style="display:flex;"><span>                pcex.<span style="color:#007f7f">initCause</span>(ex);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">throw</span> pcex;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> factory;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥è§£æè¿‡ç¨‹è°ƒç”¨JavaEEæ ‡å‡†çš„JAXPæ ‡å‡†è¿›è¡Œå¤„ç†ã€‚</p>
<p>è‡³æ­¤Spring IoCå®¹å™¨æ ¹æ®å®šä½çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶ï¼Œå°†å…¶åŠ è½½è¯»å…¥å¹¶è½¬æ¢æˆä¸ºDocumentå¯¹è±¡è¿‡ç¨‹å®Œæˆã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æSpring IoCå®¹å™¨å°†è½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ä¹‹åï¼Œæ˜¯å¦‚ä½•å°†å…¶è§£æä¸ºSpring IoCç®¡ç†çš„Beanå¯¹è±¡ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„ã€‚</p>
<h2 id="xmlbeandefinitionreaderè§£æè½½å…¥çš„beanå®šä¹‰èµ„æºæ–‡ä»¶">XmlBeanDefinitionReaderè§£æè½½å…¥çš„Beanå®šä¹‰èµ„æºæ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#xmlbeandefinitionreaderè§£æè½½å…¥çš„beanå®šä¹‰èµ„æºæ–‡ä»¶">#</a></h2>
<p>XmlBeanDefinitionReaderç±»ä¸­çš„doLoadBeanDefinitionsæ–¹æ³•æ˜¯ä»ç‰¹å®šçš„XMLæ–‡ä»¶ä¸­å®é™…è½½å…¥Beanå®šä¹‰èµ„æºçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨è½½å…¥Beanå®šä¹‰èµ„æºä¹‹åå°†å…¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ï¼Œæ¥ä¸‹æ¥è°ƒç”¨registerBeanDefinitionså¯åŠ¨Spring IoCå®¹å™¨å¯¹Beanå®šä¹‰çš„è§£æè¿‡ç¨‹ï¼ŒregisterBeanDefinitionæ–¹æ³•æºç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// æŒ‰ç…§Springçš„Beanè¯­ä¹‰è¦æ±‚å°†Beanå®šä¹‰èµ„æºè§£æå¹¶è½¬æ¢ä¸ºå®¹å™¨å†…éƒ¨æ•°æ®ç»“æ„ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">int</span> registerBeanDefinitions(Document doc, Resource resource) <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>    BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">int</span> countBefore = getRegistry().<span style="color:#007f7f">getBeanDefinitionCount</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// è§£æè¿‡ç¨‹å…¥å£ï¼Œè¿™é‡Œä½¿ç”¨äº†å§”æ´¾æ¨¡å¼ï¼Œå…·ä½“çš„è§£æå®ç°è¿‡ç¨‹æœ‰å®ç°ç±»DefaultBeanDefinitionDocumentReaderå®Œæˆ  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    documentReader.<span style="color:#007f7f">registerBeanDefinitions</span>(doc, createReaderContext(resource));
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> getRegistry().<span style="color:#007f7f">getBeanDefinitionCount</span>() - countBefore;  <span style="color:#007f7f">// è¿”å›æ­¤æ¬¡è§£æäº†å¤šå°‘ä¸ªå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// åˆ›å»ºBeanDefinitionDocumentReaderå¯¹è±¡ï¼Œè§£æDocumentå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> BeanDefinitionDocumentReader createBeanDefinitionDocumentReader() {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> BeanUtils.<span style="color:#007f7f">instantiateClass</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">documentReaderClass</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * Create the {@link XmlReaderContext} to pass over to the document reader.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> XmlReaderContext createReaderContext(Resource resource) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> XmlReaderContext(resource, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">problemReporter</span>, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">eventListener</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">sourceExtractor</span>, <span style="color:#fff;font-weight:bold">this</span>, getNamespaceHandlerResolver());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Beanå®šä¹‰èµ„æºçš„è½½å…¥è§£æåˆ†ä¸ºä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹:</p>
<p>1ã€é¦–å…ˆï¼Œé€šè¿‡è°ƒç”¨XMLè§£æå™¨å°†Beanå®šä¹‰èµ„æºæ–‡ä»¶è½¬æ¢å¾—åˆ°Documentå¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›Documentå¯¹è±¡å¹¶æ²¡æœ‰æŒ‰ç…§Springçš„Beanè§„åˆ™è¿›è¡Œè§£æã€‚è¿™ä¸€éƒ¨æ˜¯è½½å…¥çš„è¿‡ç¨‹
2ã€å…¶æ¬¡ï¼Œåœ¨å®Œæˆé€šç”¨çš„XMLè§£æä¹‹åï¼ŒæŒ‰ç…§Springçš„Beanè§„åˆ™å¯¹Documentå¯¹è±¡è¿›è¡Œè§£æã€‚</p>
<p>æŒ‰ç…§Springçš„Beanè§„åˆ™å¯¹Documentå¯¹è±¡è§£æçš„è¿‡ç¨‹æ˜¯åœ¨æ¥å£BeanDifinitionDocumentReaderçš„å®ç°ç±»DefaultBeanDefinitionDocumentReaderä¸­å®ç°çš„ã€‚</p>
<h2 id="defaultbeandefinitiondocumentreaderå¯¹beanå®šä¹‰çš„documentå¯¹è±¡è§£æ">DefaultBeanDefinitionDocumentReaderå¯¹beanå®šä¹‰çš„Documentå¯¹è±¡è§£æ<a hidden class="anchor" aria-hidden="true" href="#defaultbeandefinitiondocumentreaderå¯¹beanå®šä¹‰çš„documentå¯¹è±¡è§£æ">#</a></h2>
<p>BeanDefinitionDocumentReaderæ¥å£é€šè¿‡registerBeanDefinitionsæ–¹æ³•è°ƒç”¨å…¶å®ç°ç±»DefaultBeanDefinitionDocumentReaderå¯¹Documentå¯¹è±¡è¿›è¡Œè§£æï¼Œè§£æä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> registerBeanDefinitions(Document doc, XmlReaderContext readerContext) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">readerContext</span> = readerContext;
</span></span><span style="display:flex;"><span>    doRegisterBeanDefinitions(doc.<span style="color:#007f7f">getDocumentElement</span>());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æ³¨å†Œ&lt;beans/&gt;é…ç½®çš„Beans
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>@SuppressWarnings(<span style="color:#0ff;font-weight:bold">&#34;deprecation&#34;</span>)  <span style="color:#007f7f">// for Environment.acceptsProfiles(String...)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> doRegisterBeanDefinitions(Element root) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Any nested &lt;beans&gt; elements will cause recursion in this method. In
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// keep track of the current (parent) delegate, which may be null. Create
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// the new (child) delegate with a reference to the parent for fallback purposes,
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// then ultimately reset this.delegate back to its original (parent) reference.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#007f7f">// this behavior emulates a stack of delegates without actually necessitating one.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    BeanDefinitionParserDelegate parent = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">delegate</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">delegate</span> = createDelegate(getReaderContext(), root, parent);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">delegate</span>.<span style="color:#007f7f">isDefaultNamespace</span>(root)) {
</span></span><span style="display:flex;"><span>        String profileSpec = root.<span style="color:#007f7f">getAttribute</span>(PROFILE_ATTRIBUTE);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (StringUtils.<span style="color:#007f7f">hasText</span>(profileSpec)) {
</span></span><span style="display:flex;"><span>            String[] specifiedProfiles = StringUtils.<span style="color:#007f7f">tokenizeToStringArray</span>(
</span></span><span style="display:flex;"><span>                    profileSpec, BeanDefinitionParserDelegate.<span style="color:#007f7f">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// We cannot use Profiles.of(...) since profile expressions are not supported
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// in XML config. See SPR-12458 for details.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (!getReaderContext().<span style="color:#007f7f">getEnvironment</span>().<span style="color:#007f7f">acceptsProfiles</span>(specifiedProfiles)) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isDebugEnabled</span>()) {
</span></span><span style="display:flex;"><span>                    logger.<span style="color:#007f7f">debug</span>(<span style="color:#0ff;font-weight:bold">&#34;Skipped XML bean definition file due to specified profiles [&#34;</span> + profileSpec +
</span></span><span style="display:flex;"><span>                            <span style="color:#0ff;font-weight:bold">&#34;] not matching: &#34;</span> + getReaderContext().<span style="color:#007f7f">getResource</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    preProcessXml(root);
</span></span><span style="display:flex;"><span>    parseBeanDefinitions(root, <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">delegate</span>); <span style="color:#007f7f">// ä»Documentçš„æ ¹å…ƒç´ å¼€å§‹è¿›è¡ŒBeanå®šä¹‰çš„Documentå¯¹è±¡  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    postProcessXml(root);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">delegate</span> = parent;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="beandefinitionparserdelegate-è§£æbeanå®šä¹‰èµ„æºæ–‡ä»¶ç”Ÿæˆbeandefinition">BeanDefinitionParserDelegate è§£æBeanå®šä¹‰èµ„æºæ–‡ä»¶ç”ŸæˆBeanDefinition<a hidden class="anchor" aria-hidden="true" href="#beandefinitionparserdelegate-è§£æbeanå®šä¹‰èµ„æºæ–‡ä»¶ç”Ÿæˆbeandefinition">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * Parse the elements at the root level in the document:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * &#34;import&#34;, &#34;alias&#34;, &#34;bean&#34;.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * @param root the DOM root element of the document
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">isDefaultNamespace</span>(root)) {
</span></span><span style="display:flex;"><span>        NodeList nl = root.<span style="color:#007f7f">getChildNodes</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = <span style="color:#ff0;font-weight:bold">0</span>; i &lt; nl.<span style="color:#007f7f">getLength</span>(); i++) {
</span></span><span style="display:flex;"><span>            Node node = nl.<span style="color:#007f7f">item</span>(i);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (node <span style="color:#fff;font-weight:bold">instanceof</span> Element) {
</span></span><span style="display:flex;"><span>                Element ele = (Element) node;
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">isDefaultNamespace</span>(ele)) {
</span></span><span style="display:flex;"><span>                    parseDefaultElement(ele, delegate);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    delegate.<span style="color:#007f7f">parseCustomElement</span>(ele);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        delegate.<span style="color:#007f7f">parseCustomElement</span>(root);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">void</span> parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) {
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå…ƒç´ èŠ‚ç‚¹æ˜¯&lt;Import&gt;å¯¼å…¥å…ƒç´ ï¼Œè¿›è¡Œå¯¼å…¥è§£æ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">nodeNameEquals</span>(ele, IMPORT_ELEMENT)) {
</span></span><span style="display:flex;"><span>        importBeanDefinitionResource(ele);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå…ƒç´ èŠ‚ç‚¹æ˜¯&lt;Alias&gt;åˆ«åå…ƒç´ ï¼Œè¿›è¡Œåˆ«åè§£æ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">nodeNameEquals</span>(ele, ALIAS_ELEMENT)) {
</span></span><span style="display:flex;"><span>        processAliasRegistration(ele);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå…ƒç´ èŠ‚ç‚¹&lt;Bean&gt;å…ƒç´ , æŒ‰ç…§Springçš„Beanè§„åˆ™è§£æå…ƒç´   
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">nodeNameEquals</span>(ele, BEAN_ELEMENT)) {
</span></span><span style="display:flex;"><span>        processBeanDefinition(ele, delegate);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå…ƒç´ èŠ‚ç‚¹&lt;Beans&gt;å…ƒç´ ï¼Œå³å®ƒæ˜¯åµŒå¥—ç±»å‹çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (delegate.<span style="color:#007f7f">nodeNameEquals</span>(ele, NESTED_BEANS_ELEMENT)) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// é€’å½’è§£æ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        doRegisterBeanDefinitions(ele);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è§£æBeanç”ŸæˆBeanDefinitionHolderçš„æ–¹æ³•</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * Process the given bean element, parsing the bean definition
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    * and registering it with the registry.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">    */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> <span style="color:#fff;font-weight:bold">void</span> processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) {
</span></span><span style="display:flex;"><span>    BeanDefinitionHolder bdHolder = delegate.<span style="color:#007f7f">parseBeanDefinitionElement</span>(ele);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (bdHolder != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        bdHolder = delegate.<span style="color:#007f7f">decorateBeanDefinitionIfRequired</span>(ele, bdHolder);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// æ³¨å†Œæœ€ç»ˆçš„è£…é¥°å®ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            BeanDefinitionReaderUtils.<span style="color:#007f7f">registerBeanDefinition</span>(bdHolder, getReaderContext().<span style="color:#007f7f">getRegistry</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">catch</span> (BeanDefinitionStoreException ex) {
</span></span><span style="display:flex;"><span>            getReaderContext().<span style="color:#007f7f">error</span>(<span style="color:#0ff;font-weight:bold">&#34;Failed to register bean definition with name &#39;&#34;</span> +
</span></span><span style="display:flex;"><span>                    bdHolder.<span style="color:#007f7f">getBeanName</span>() + <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span>, ele, ex);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Send registration event.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        getReaderContext().<span style="color:#007f7f">fireComponentRegistered</span>(<span style="color:#fff;font-weight:bold">new</span> BeanComponentDefinition(bdHolder));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è§£æè¿‡åçš„beandefinitionåœ¨iocå®¹å™¨ä¸­æ³¨å†Œ">è§£æè¿‡åçš„BeanDefinitionåœ¨IoCå®¹å™¨ä¸­æ³¨å†Œ<a hidden class="anchor" aria-hidden="true" href="#è§£æè¿‡åçš„beandefinitionåœ¨iocå®¹å™¨ä¸­æ³¨å†Œ">#</a></h2>
<p>Documentå¯¹è±¡çš„è§£æåå¾—åˆ°å°è£…BeanDefinitionçš„BeanDifinitionHoldå¯¹è±¡ï¼Œç„¶åè°ƒç”¨BeanDefinitionReaderUtilsçš„registerBeanDefinitionæ–¹æ³•å‘IoCå®¹å™¨æ³¨å†Œè§£æçš„Beanï¼ŒBeanDefinitionReaderUtilsçš„æ³¨å†Œçš„æºç å¦‚ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// é€šè¿‡BeanDefinitionRegistryå°†BeanDefinitionHolderæ³¨å†Œåˆ°BeanFactory
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> registerBeanDefinition(
</span></span><span style="display:flex;"><span>        BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Register bean definition under primary name.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    String beanName = definitionHolder.<span style="color:#007f7f">getBeanName</span>();
</span></span><span style="display:flex;"><span>    registry.<span style="color:#007f7f">registerBeanDefinition</span>(beanName, definitionHolder.<span style="color:#007f7f">getBeanDefinition</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// Register aliases for bean name, if any.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    String[] aliases = definitionHolder.<span style="color:#007f7f">getAliases</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (aliases != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String alias : aliases) {
</span></span><span style="display:flex;"><span>            registry.<span style="color:#007f7f">registerAlias</span>(beanName, alias);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“è°ƒç”¨BeanDefinitionReaderUtilså‘IoCå®¹å™¨æ³¨å†Œè§£æçš„BeanDefinitionæ—¶ï¼ŒçœŸæ­£å®Œæˆæ³¨å†ŒåŠŸèƒ½çš„æ˜¯DefaultListableBeanFactory.</p>
<h2 id="defaultlistablebeanfactory-å‘iocå®¹å™¨æ³¨å†Œè§£æåçš„beandefinition">DefaultListableBeanFactory å‘IoCå®¹å™¨æ³¨å†Œè§£æåçš„BeanDefinition<a hidden class="anchor" aria-hidden="true" href="#defaultlistablebeanfactory-å‘iocå®¹å™¨æ³¨å†Œè§£æåçš„beandefinition">#</a></h2>
<p>IoCå®¹å™¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªbeanDefinitionMapï¼Œæ³¨å†Œå³å°†BeanDefinition put åˆ°mapä¸­ã€‚</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">85
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/** Map of bean definition objects, keyed by bean name. */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;(<span style="color:#ff0;font-weight:bold">256</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/** Map from bean name to merged BeanDefinitionHolder. */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, BeanDefinitionHolder&gt; mergedBeanDefinitionHolders = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;(<span style="color:#ff0;font-weight:bold">256</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> registerBeanDefinition(String beanName, BeanDefinition beanDefinition)
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">throws</span> BeanDefinitionStoreException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Assert.<span style="color:#007f7f">hasText</span>(beanName, <span style="color:#0ff;font-weight:bold">&#34;Bean name must not be empty&#34;</span>);
</span></span><span style="display:flex;"><span>    Assert.<span style="color:#007f7f">notNull</span>(beanDefinition, <span style="color:#0ff;font-weight:bold">&#34;BeanDefinition must not be null&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (beanDefinition <span style="color:#fff;font-weight:bold">instanceof</span> AbstractBeanDefinition) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            ((AbstractBeanDefinition) beanDefinition).<span style="color:#007f7f">validate</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">catch</span> (BeanDefinitionValidationException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionStoreException(beanDefinition.<span style="color:#007f7f">getResourceDescription</span>(), beanName,
</span></span><span style="display:flex;"><span>                    <span style="color:#0ff;font-weight:bold">&#34;Validation of bean definition failed&#34;</span>, ex);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    BeanDefinition existingDefinition = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionMap</span>.<span style="color:#007f7f">get</span>(beanName);
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœå·²ç»æ³¨å†Œ
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (existingDefinition != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// æ£€æŸ¥æ˜¯å¦å¯ä»¥è¦†ç›–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">if</span> (!isAllowBeanDefinitionOverriding()) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (existingDefinition.<span style="color:#007f7f">getRole</span>() &lt; beanDefinition.<span style="color:#007f7f">getRole</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isInfoEnabled</span>()) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#007f7f">info</span>(<span style="color:#0ff;font-weight:bold">&#34;Overriding user-defined bean definition for bean &#39;&#34;</span> + beanName +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;&#39; with a framework-generated bean definition: replacing [&#34;</span> +
</span></span><span style="display:flex;"><span>                        existingDefinition + <span style="color:#0ff;font-weight:bold">&#34;] with [&#34;</span> + beanDefinition + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (!beanDefinition.<span style="color:#007f7f">equals</span>(existingDefinition)) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isDebugEnabled</span>()) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#007f7f">debug</span>(<span style="color:#0ff;font-weight:bold">&#34;Overriding bean definition for bean &#39;&#34;</span> + beanName +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;&#39; with a different definition: replacing [&#34;</span> + existingDefinition +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;] with [&#34;</span> + beanDefinition + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (logger.<span style="color:#007f7f">isTraceEnabled</span>()) {
</span></span><span style="display:flex;"><span>                logger.<span style="color:#007f7f">trace</span>(<span style="color:#0ff;font-weight:bold">&#34;Overriding bean definition for bean &#39;&#34;</span> + beanName +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;&#39; with an equivalent definition: replacing [&#34;</span> + existingDefinition +
</span></span><span style="display:flex;"><span>                        <span style="color:#0ff;font-weight:bold">&#34;] with [&#34;</span> + beanDefinition + <span style="color:#0ff;font-weight:bold">&#34;]&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// è¦†ç›–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionMap</span>.<span style="color:#007f7f">put</span>(beanName, beanDefinition);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (hasBeanCreationStarted()) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Cannot modify startup-time collection elements anymore (for stable iteration)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionMap</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionMap</span>.<span style="color:#007f7f">put</span>(beanName, beanDefinition);
</span></span><span style="display:flex;"><span>                List&lt;String&gt; updatedDefinitions = <span style="color:#fff;font-weight:bold">new</span> ArrayList&lt;&gt;(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionNames</span>.<span style="color:#007f7f">size</span>() + <span style="color:#ff0;font-weight:bold">1</span>);
</span></span><span style="display:flex;"><span>                updatedDefinitions.<span style="color:#007f7f">addAll</span>(<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionNames</span>);
</span></span><span style="display:flex;"><span>                updatedDefinitions.<span style="color:#007f7f">add</span>(beanName);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionNames</span> = updatedDefinitions;
</span></span><span style="display:flex;"><span>                removeManualSingletonName(beanName);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Still in startup registration phase
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionMap</span>.<span style="color:#007f7f">put</span>(beanName, beanDefinition);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">beanDefinitionNames</span>.<span style="color:#007f7f">add</span>(beanName);
</span></span><span style="display:flex;"><span>            removeManualSingletonName(beanName);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//é‡ç½®æ‰€æœ‰å·²ç»æ³¨å†Œè¿‡çš„BeanDefinitionçš„ç¼“å­˜  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">frozenBeanDefinitionNames</span> = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (existingDefinition != <span style="color:#fff;font-weight:bold">null</span> || containsSingleton(beanName)) {
</span></span><span style="display:flex;"><span>        resetBeanDefinition(beanName);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (isConfigurationFrozen()) {
</span></span><span style="display:flex;"><span>        clearByTypeCache();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡³æ­¤ï¼ŒBeanå®šä¹‰èµ„æºæ–‡ä»¶ä¸­é…ç½®çš„Beanè¢«è§£æè¿‡åï¼Œå·²ç»æ³¨å†Œåˆ°IoCå®¹å™¨ä¸­ï¼Œè¢«å®¹å™¨ç®¡ç†èµ·æ¥ï¼ŒçœŸæ­£å®Œæˆäº†IoCå®¹å™¨åˆå§‹åŒ–æ‰€åšçš„å…¨éƒ¨å·¥ä½œã€‚ç°åœ¨IoCå®¹å™¨ä¸­å·²ç»å»ºç«‹äº†æ•´ä¸ªBeançš„é…ç½®ä¿¡æ¯ï¼Œè¿™äº›BeanDefinitionä¿¡æ¯å·²ç»å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è¢«æ£€ç´¢ï¼ŒIoCå®¹å™¨çš„ä½œç”¨å°±æ˜¯å¯¹è¿™äº›æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯è¿›è¡Œå¤„ç†å’Œç»´æŠ¤ã€‚è¿™äº›çš„æ³¨å†Œçš„Beanå®šä¹‰ä¿¡æ¯æ˜¯IoCå®¹å™¨æ§åˆ¶åè½¬çš„åŸºç¡€ï¼Œæ­£æ˜¯æœ‰äº†è¿™äº›æ³¨å†Œçš„æ•°æ®ï¼Œå®¹å™¨æ‰å¯ä»¥è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>ç°åœ¨é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæ€»ç»“ä¸€ä¸‹IoCå®¹å™¨åˆå§‹åŒ–çš„åŸºæœ¬æ­¥éª¤ï¼š</p>
<li>åˆå§‹åŒ–çš„å…¥å£åœ¨å®¹å™¨å®ç°ä¸­çš„refresh()è°ƒç”¨æ¥å®Œæˆ</li>
<li>å¯¹beanå®šä¹‰è½½å…¥IoCå®¹å™¨ä½¿ç”¨çš„æ–¹æ³•æ˜¯loadBeanDefinitionï¼Œå…¶ä¸­å¤§è‡´è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>
1ã€é€šè¿‡ResourceLoaderæ¥å®Œæˆèµ„æºæ–‡ä»¶ä½ç½®çš„å®šä½ï¼ŒDefaultResourceLoaderæ˜¯é»˜è®¤çš„å®ç°ï¼ŒåŒæ—¶ä¸Šä¸‹æ–‡æœ¬èº«å°±ç»™å‡ºäº†ResourceLoaderçš„å®ç°ï¼Œå¯ä»¥ä»ç±»è·¯å¾„ï¼Œæ–‡ä»¶ç³»ç»Ÿï¼ŒURLç­‰æ–¹å¼æ¥å®šä¹‰ä¸ºèµ„æºä½ç½®ã€‚å¦‚æœæ˜¯XmlBeanFactoryä½œä¸ºIOCå®¹å™¨ï¼Œé‚£ä¹ˆéœ€è¦ä¸ºå®ƒæŒ‡å®šbeanå®šä¹‰çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´beanå®šä¹‰æ–‡ä»¶æ—¶é€šè¿‡æŠ½è±¡æˆResourceæ¥è¢«IOCå®¹å™¨å¤„ç†çš„ã€‚
<p>2ã€é€šè¿‡BeanDefinitionReaderæ¥å®Œæˆå®šä¹‰ä¿¡æ¯çš„è§£æå’ŒBeanä¿¡æ¯çš„æ³¨å†Œï¼Œå¾€å¾€ä½¿ç”¨çš„æ˜¯XmlBeanDefinitionReaderæ¥è§£æbeançš„xmlå®šä¹‰æ–‡ä»¶-å®é™…çš„å¤„ç†è¿‡ç¨‹æ˜¯å§”æ‰˜ç»™BeanDefinitionParserDelegateæ¥å®Œæˆçš„ï¼Œä»è€Œå¾—åˆ°beançš„å®šä¹‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åœ¨Springä¸­ä½¿ç”¨BeanDefinitionå¯¹è±¡æ¥è¡¨ç¤º-è¿™ä¸ªåå­—å¯ä»¥è®©æˆ‘ä»¬æƒ³åˆ°loadBeanDefinition,RegisterBeanDefinitionè¿™äº›ç›¸å…³æ–¹æ³•-ä»–ä»¬éƒ½æ˜¯ä¸ºå¤„ç†BeanDefinitinæœåŠ¡çš„ã€‚
3ã€å®¹å™¨è§£æå¾—åˆ°BeanDefinitionä»¥åï¼Œéœ€è¦æŠŠå®ƒåœ¨IOCå®¹å™¨ä¸­æ³¨å†Œï¼Œè¿™ç”±IOCå®ç°BeanDefinitionRegisteræ¥å£æ¥å®ç°ã€‚æ³¨å†Œè¿‡ç¨‹å°±æ˜¯åœ¨IOCå®¹å™¨å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªHashMapæ¥ä¿å­˜å¾—åˆ°çš„BeanDefinitionçš„è¿‡ç¨‹ã€‚è¿™ä¸ªHashMapæ˜¯IoCå®¹å™¨æŒæœ‰beanä¿¡æ¯çš„åœºæ‰€ï¼Œä»¥åå¯¹beançš„æ“ä½œéƒ½æ˜¯å›´ç»•è¿™ä¸ªHashMapæ¥å®ç°çš„ã€‚</p>
</li>
<li>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡BeanFactoryå’ŒApplicationCOntextæ¥äº«å—åˆ°SPring IOCçš„æœåŠ¡äº†ï¼Œåœ¨ä½¿ç”¨IoCå®¹å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°é™¤äº†å°‘é‡ç²˜åˆä»£ç ï¼Œç»å¤§å¤šæ•°ä»¥æ­£ç¡®IoCé£æ ¼ç¼–å†™çš„åº”ç”¨ç¨‹åºä»£ç å®Œå…¨ä¸ç”¨å…³å¿ƒå¦‚ä½•åˆ°è¾¾å·¥å‚ï¼Œå› ä¸ºå®¹å™¨å°†æŠŠè¿™äº›å¯¹è±¡ä¸å®¹å™¨ç®¡ç†çš„å…¶ä»–å¯¹è±¡é’©åœ¨ä¸€èµ·ã€‚åŸºæœ¬çš„ç­–ç•¥æ˜¯æŠŠå·¥å‚æ”¾åˆ°å·²çŸ¥çš„åœ°æ–¹ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨å¯¹é¢„æœŸä½¿ç”¨çš„ä¸Šä¸‹æ–‡æœ‰æ„ä¹‰çš„åœ°æ–¹ï¼Œä»¥åŠä»£ç å°†å®é™…éœ€è¦è®¿é—®å·¥å‚çš„åœ°æ–¹ã€‚Springæœ¬èº«æä¾›äº†å¯¹å£°æ˜å¼è½½å…¥Webåº”ç”¨ç¨‹åºç”¨æ³•çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ServletContextä¸­çš„æ¡†æ¶å®ç°ã€‚</li>
<h2 id="springä¸­getbeançš„ä¸»ä½“æ€è·¯">Springä¸­getBeançš„ä¸»ä½“æ€è·¯<a hidden class="anchor" aria-hidden="true" href="#springä¸­getbeançš„ä¸»ä½“æ€è·¯">#</a></h2>
<p>BeanFactoryå®ç°getBeanæ–¹æ³•åœ¨AbstractBeanFactoryä¸­ï¼Œè¿™ä¸ªæ–¹æ³•é‡è½½éƒ½æ˜¯è°ƒç”¨doGetBeanæ–¹æ³•è¿›è¡Œå®ç°çš„:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Object getBean(String name) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> doGetBean(name, <span style="color:#fff;font-weight:bold">null</span>, <span style="color:#fff;font-weight:bold">null</span>, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> doGetBean(name, requiredType, <span style="color:#fff;font-weight:bold">null</span>, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> Object getBean(String name, Object... args) <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> doGetBean(name, <span style="color:#fff;font-weight:bold">null</span>, args, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> &lt;T&gt; T getBean(String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object... args)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> doGetBean(name, requiredType, args, <span style="color:#fff;font-weight:bold">false</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥çœ‹ä¸‹doGetBeanæ–¹æ³•(è¿™ä¸ªæ–¹æ³•å¾ˆé•¿ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹å®ƒçš„æ•´ä½“æ€è·¯å’Œè®¾è®¡è¦ç‚¹):</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">  9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 82
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 83
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 84
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 85
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 86
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 87
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 88
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 89
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 90
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 91
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 92
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 93
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 94
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 95
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 96
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 97
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 98
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 99
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">100
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">101
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">102
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">103
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">104
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">105
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">106
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">107
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">108
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">109
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">110
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">111
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">112
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">113
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">114
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">115
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">116
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">117
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">118
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">119
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">120
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">121
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">122
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">123
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">124
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">125
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">126
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">127
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">128
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">129
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">130
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">131
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">132
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">133
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">134
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">135
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">136
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">137
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">138
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">139
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">140
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">141
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">142
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">143
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">144
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">145
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">146
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">147
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">// å‚æ•°typeCheckOnlyï¼šbeanå®ä¾‹æ˜¯å¦åŒ…å«ä¸€ä¸ªç±»å‹æ£€æŸ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">protected</span> &lt;T&gt; T doGetBean(
</span></span><span style="display:flex;"><span>			String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, <span style="color:#fff;font-weight:bold">boolean</span> typeCheckOnly)
</span></span><span style="display:flex;"><span>			<span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &amp;ï¼Œéœ€è¦å»æ‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  String beanName = transformedBeanName(name);
</span></span><span style="display:flex;"><span>  Object beanInstance;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// Eagerly check singleton cache for manually registered singletons.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  Object sharedInstance = getSingleton(beanName);
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">if</span> (sharedInstance != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; args == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// æ— å‚å•ä¾‹ä»ç¼“å­˜ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (isPrototypeCurrentlyInCreation(beanName)) {
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanCurrentlyInCreationException(beanName);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">// å¦‚æœ bean definition å­˜åœ¨äºçˆ¶çš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    BeanFactory parentBeanFactory = getParentBeanFactory();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (parentBeanFactory != <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; !containsBeanDefinition(beanName)) {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// Not found -&gt; check parent.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      String nameToLookup = originalBeanName(name);
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">if</span> (parentBeanFactory <span style="color:#fff;font-weight:bold">instanceof</span> AbstractBeanFactory) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> ((AbstractBeanFactory) parentBeanFactory).<span style="color:#007f7f">doGetBean</span>(
</span></span><span style="display:flex;"><span>            nameToLookup, requiredType, args, typeCheckOnly);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (args != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// Delegation to parent with explicit args.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> (T) parentBeanFactory.<span style="color:#007f7f">getBean</span>(nameToLookup, args);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (requiredType != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// No args -&gt; delegate to standard getBean method.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">return</span> parentBeanFactory.<span style="color:#007f7f">getBean</span>(nameToLookup, requiredType);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> (T) parentBeanFactory.<span style="color:#007f7f">getBean</span>(nameToLookup);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">if</span> (!typeCheckOnly) {
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// å°†å½“å‰beanå®ä¾‹æ”¾å…¥alreadyCreatedé›†åˆé‡Œï¼Œæ ‡è¯†è¿™ä¸ªbeanå‡†å¤‡åˆ›å»ºäº†
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      markBeanAsCreated(beanName);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    StartupStep beanCreation = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">applicationStartup</span>.<span style="color:#007f7f">start</span>(<span style="color:#0ff;font-weight:bold">&#34;spring.beans.instantiate&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#007f7f">tag</span>(<span style="color:#0ff;font-weight:bold">&#34;beanName&#34;</span>, name);
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">if</span> (requiredType != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        beanCreation.<span style="color:#007f7f">tag</span>(<span style="color:#0ff;font-weight:bold">&#34;beanType&#34;</span>, requiredType::toString);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);
</span></span><span style="display:flex;"><span>      checkMergedBeanDefinition(mbd, beanName, args);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–äº†.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      String[] dependsOn = mbd.<span style="color:#007f7f">getDependsOn</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">if</span> (dependsOn != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (String dep : dependsOn) {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">if</span> (isDependent(beanName, dep)) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanCreationException(mbd.<span style="color:#007f7f">getResourceDescription</span>(), beanName,
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;Circular depends-on relationship between &#39;&#34;</span> + beanName + <span style="color:#0ff;font-weight:bold">&#34;&#39; and &#39;&#34;</span> + dep + <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span>);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          registerDependentBean(dep, beanName);
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            getBean(dep); <span style="color:#007f7f">// åˆå§‹åŒ–å®ƒä¾èµ–çš„Bean
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">catch</span> (NoSuchBeanDefinitionException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> BeanCreationException(mbd.<span style="color:#007f7f">getResourceDescription</span>(), beanName,
</span></span><span style="display:flex;"><span>                <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span> + beanName + <span style="color:#0ff;font-weight:bold">&#34;&#39; depends on missing bean &#39;&#34;</span> + dep + <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span>, ex);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// åˆ›å»ºBeanå®ä¾‹ï¼šå•ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="color:#fff;font-weight:bold">if</span> (mbd.<span style="color:#007f7f">isSingleton</span>()) {
</span></span><span style="display:flex;"><span>        sharedInstance = getSingleton(beanName, () -&gt; {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// çœŸæ­£åˆ›å»ºbeançš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">return</span> createBean(beanName, mbd, args);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">catch</span> (BeansException ex) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">// Explicitly remove instance from singleton cache: It might have been put there
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// eagerly by the creation process, to allow for circular reference resolution.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#007f7f">// Also remove any beans that received a temporary reference to the bean.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            destroySingleton(beanName);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">throw</span> ex;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// åˆ›å»ºBeanå®ä¾‹ï¼šåŸå‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (mbd.<span style="color:#007f7f">isPrototype</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">// It&#39;s a prototype -&gt; create a new instance.
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Object prototypeInstance = <span style="color:#fff;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>          beforePrototypeCreation(beanName);
</span></span><span style="display:flex;"><span>          prototypeInstance = createBean(beanName, mbd, args);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>          afterPrototypeCreation(beanName);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#007f7f">// åˆ›å»ºBeanå®ä¾‹ï¼šæ ¹æ®beançš„scopeåˆ›å»º
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>      <span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        String scopeName = mbd.<span style="color:#007f7f">getScope</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (!StringUtils.<span style="color:#007f7f">hasLength</span>(scopeName)) {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;No scope name defined for bean Â´&#34;</span> + beanName + <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Scope scope = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">scopes</span>.<span style="color:#007f7f">get</span>(scopeName);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (scope == <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> IllegalStateException(<span style="color:#0ff;font-weight:bold">&#34;No Scope registered for scope name &#39;&#34;</span> + scopeName + <span style="color:#0ff;font-weight:bold">&#34;&#39;&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>          Object scopedInstance = scope.<span style="color:#007f7f">get</span>(beanName, () -&gt; {
</span></span><span style="display:flex;"><span>            beforePrototypeCreation(beanName);
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#fff;font-weight:bold">return</span> createBean(beanName, mbd, args);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>              afterPrototypeCreation(beanName);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          });
</span></span><span style="display:flex;"><span>          beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">catch</span> (IllegalStateException ex) {
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> ScopeNotActiveException(beanName, scopeName, ex);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">catch</span> (BeansException ex) {
</span></span><span style="display:flex;"><span>      beanCreation.<span style="color:#007f7f">tag</span>(<span style="color:#0ff;font-weight:bold">&#34;exception&#34;</span>, ex.<span style="color:#007f7f">getClass</span>().<span style="color:#007f7f">toString</span>());
</span></span><span style="display:flex;"><span>      beanCreation.<span style="color:#007f7f">tag</span>(<span style="color:#0ff;font-weight:bold">&#34;message&#34;</span>, String.<span style="color:#007f7f">valueOf</span>(ex.<span style="color:#007f7f">getMessage</span>()));
</span></span><span style="display:flex;"><span>      cleanupAfterBeanCreationFailure(beanName);
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">throw</span> ex;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>      beanCreation.<span style="color:#007f7f">end</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> adaptBeanInstance(name, beanInstance, requiredType);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°ä»£ç ä¸»è¦çœ‹ä¸­æ–‡æ³¨é‡Šå³å¯:</p>
<li>è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &ï¼Œéœ€è¦å»æ‰</li>
<li>æ— å‚å•ä¾‹å…ˆä»ç¼“å­˜ä¸­è·å–</li>
<li>å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li>
<li>å¦‚æœbean definitionå­˜åœ¨äºçš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å–</li>
<li>æ ‡è®°è¿™ä¸ªbeanNameçš„å®ä¾‹æ­£åœ¨åˆ›å»º</li>
<li>ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–</li>
<li>çœŸæ­£åˆ›å»º:<br>
1. å•ä¾‹æ—¶<br>
2. åŸå‹æ—¶<br>
3. æ ¹æ®beançš„scopeåˆ›å»º
</li>
<h2 id="é‡ç‚¹-springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜">é‡ç‚¹: SPringå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜<a hidden class="anchor" aria-hidden="true" href="#é‡ç‚¹-springå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜">#</a></h2>
<p><b>é¦–å…ˆæˆ‘ä»¬éœ€è¦å£°æ˜ï¼ŒSpringåªæ˜¯è§£å†³äº†å•ä¾‹æ¨¡å¼ä¸‹å±æ€§ä¾èµ–çš„å¾ªç¯é—®é¢˜ï¼›Springä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚</b></p>
<h2 id="springå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ–">Springå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#springå•ä¾‹æ¨¡å¼ä¸‹çš„å±æ€§ä¾èµ–">#</a></h2>
<p>å…ˆæ¥çœ‹ä¸‹è¿™ä¸‰çº§ç¼“å­˜</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/** Cache of singleton objects: bean name --&gt; bean instance */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, Object&gt; singletonObjects = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;String, Object&gt;(<span style="color:#ff0;font-weight:bold">256</span>);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/** Cache of early singleton objects: bean name --&gt; bean instance */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;String, Object&gt;(<span style="color:#ff0;font-weight:bold">16</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/** Cache of singleton factories: bean name --&gt; ObjectFactory */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;String, ObjectFactory&lt;?&gt;&gt;(<span style="color:#ff0;font-weight:bold">16</span>);
</span></span></code></pre></td></tr></table>
</div>
</div><li>ç¬¬ä¸€çº§ç¼“å­˜(singletonObjects): å•ä¾‹å¯¹è±¡ç¼“å­˜æ± ï¼Œå·²ç»å®ä¾‹åŒ–å¹¶ä¸”å±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯æˆç†Ÿå¯¹è±¡</li>
<li>ç¬¬äºŒå±‚ç¼“å­˜(earlySingletonObjects): å•ä¾‹å¯¹è±¡ç¼“å­˜æ± ï¼Œå·²ç»å®ä¾‹åŒ–ä½†å°šæœªå±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯åŠæˆå“å¯¹è±¡</li>
<li>ç¬¬ä¸‰å±‚ç¼“å­˜(singletonFactories): å•ä¾‹å·¥å‚çš„ç¼“å­˜</li>
<p>å¦‚ä¸‹æ˜¯è·å–å•ä¾‹ä¸­:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">protected</span> Object getSingleton(String beanName, <span style="color:#fff;font-weight:bold">boolean</span> allowEarlyReference) {
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// Springé¦–å…ˆä»singletonObjectsï¼ˆä¸€çº§ç¼“å­˜ï¼‰ä¸­å°è¯•è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  Object singletonObject = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">singletonObjects</span>.<span style="color:#007f7f">get</span>(beanName);
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">// è‹¥æ˜¯è·å–ä¸åˆ°è€Œä¸”å¯¹è±¡åœ¨å»ºç«‹ä¸­ï¼Œåˆ™å°è¯•ä»earlySingletonObjects(äºŒçº§ç¼“å­˜)ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>  <span style="color:#fff;font-weight:bold">if</span> (singletonObject == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">singletonObjects</span>) {
</span></span><span style="display:flex;"><span>        singletonObject = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">earlySingletonObjects</span>.<span style="color:#007f7f">get</span>(beanName);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (singletonObject == <span style="color:#fff;font-weight:bold">null</span> &amp;&amp; allowEarlyReference) {
</span></span><span style="display:flex;"><span>          ObjectFactory&lt;?&gt; singletonFactory = <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">singletonFactories</span>.<span style="color:#007f7f">get</span>(beanName);
</span></span><span style="display:flex;"><span>          <span style="color:#fff;font-weight:bold">if</span> (singletonFactory != <span style="color:#fff;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//è‹¥æ˜¯ä»æ˜¯è·å–ä¸åˆ°è€Œä¸”å®¹è®¸ä»singletonFactoriesç»è¿‡getObjectè·å–ï¼Œåˆ™ç»è¿‡singletonFactory.getObject()(ä¸‰çº§ç¼“å­˜)è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>              singletonObject = singletonFactory.<span style="color:#007f7f">getObject</span>();
</span></span><span style="display:flex;"><span>              <span style="color:#007f7f">//è‹¥æ˜¯è·å–åˆ°äº†åˆ™å°†singletonObjectæ”¾å…¥åˆ°earlySingletonObjects,ä¹Ÿå°±æ˜¯å°†ä¸‰çº§ç¼“å­˜æé«˜åˆ°äºŒçº§ç¼“å­˜ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>              <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">earlySingletonObjects</span>.<span style="color:#007f7f">put</span>(beanName, singletonObject);
</span></span><span style="display:flex;"><span>              <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">singletonFactories</span>.<span style="color:#007f7f">remove</span>(beanName);
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> (singletonObject != NULL_OBJECT ? singletonObject : <span style="color:#fff;font-weight:bold">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¡¥å……ä¸€äº›æ–¹æ³•å’Œå‚æ•°</p>
<li>isSingletonCurrentlyIncreation(): åˆ¤æ–­å½“å‰å•ä¾‹beanæ˜¯å¦æ­£åœ¨å»ºç«‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆå§‹åŒ–å®Œæˆ(å¥½æ¯”Açš„æ„é€ å™¨ä¾èµ–äº†Bå¯¹è±¡å› æ­¤å¾—å…ˆå»å»ºç«‹Bå¯¹è±¡ï¼Œæˆ–åˆ™åœ¨Aå¾—populateBeanè¿‡ç¨‹å½“ä¸­ä¾èµ–äº†Bå¯¹è±¡ï¼Œå¾—å…ˆå»å»ºç«‹Bå¯¹è±¡ï¼Œè¿™æ—¶å¾—Aå°±æ˜¯å¤„äºå»ºç«‹ä¸­çš„çŠ¶æ€ã€‚)</li>
<li>allowEarlyRefrence: æ˜¯å¦å®¹è®¸ä»singletonFactoriesä¸­ç»è¿‡getObjectæ‹¿åˆ°å¯¹è±¡</li>
<p>åˆ†ægetSinflwton()æ•´ä¸ªè¿‡ç¨‹ï¼ŒSpringé¦–å…ˆä»ä¸€çº§ç¼“å­˜singletonObjectsä¸­è·å–ã€‚è‹¥æ˜¯è·å–ä¸åˆ°ï¼Œè€Œä¸”å¯¹è±¡æ­£åœ¨å»ºç«‹ä¸­ï¼Œå°±å†ä»äºŒçº§ç¼“å­˜earlySingletonObjectsä¸­è·å–ã€‚è‹¥æ˜¯ä»æ˜¯è·å–ä¸åˆ°ä¸”å®¹è®¸singletonFactoriesç»è¿‡getObject()è·å–ï¼Œå°±ä»ä¸‰çº§ç¼“å­˜singlwtonFactory.getObject()(ä¸‰çº§ç¼“å­˜)è·å–ï¼Œè‹¥æ˜¯è·å–åˆ°äº†åˆ™ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜ã€‚</p>
<p>ä»ä¸Šé¢ä¸‰çº§ç¼“å­˜çš„åˆ†æï¼Œå’±ä»¬èƒ½å¤ŸçŸ¥é“ï¼ŒSpringè§£å†³å¾ªç¯ä¾èµ–çš„è¯€çªå°±åœ¨äºsingletonFactoriesè¿™ä¸ªä¸‰çº§cacheã€‚è¿™ä¸ªcacheçš„ç±»å‹æ˜¯ObjectFactory,å®šä¹‰ä»¥ä¸‹:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> ObjectFactory&lt;T&gt; {
</span></span><span style="display:flex;"><span>    T getObject() <span style="color:#fff;font-weight:bold">throws</span> BeansException;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨beanå»ºç«‹è¿‡ç¨‹å½“ä¸­ï¼Œæœ‰ä¸¤å¤„æ¯”è¾ƒé‡è¦çš„åŒ¿åå†…éƒ¨ç±»å®ç°äº†è¯¥æ¥å£ã€‚ä¸€å¤„æ˜¯Springåˆ©ç”¨å…¶å»ºç«‹beançš„æ—¶å€™ï¼Œå¦å¤–ä¸€å¤„å°±æ˜¯:</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>addSingletonFactory(beanName, <span style="color:#fff;font-weight:bold">new</span> ObjectFactory&lt;Object&gt;() {
</span></span><span style="display:flex;"><span>   @Override   <span style="color:#fff;font-weight:bold">public</span> Object getObject() <span style="color:#fff;font-weight:bold">throws</span> BeansException {
</span></span><span style="display:flex;"><span>      <span style="color:#fff;font-weight:bold">return</span> getEarlyBeanReference(beanName, mbd, bean);
</span></span><span style="display:flex;"><span>   }});
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤å¤„å°±æ˜¯è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ï¼Œè¿™æ®µä»£ç å‘ç”Ÿåœ¨createBeanInstanceä»¥åï¼Œä¹Ÿå°±æ˜¯è¯´å•ä¾‹å¯¹è±¡æ­¤æ—¶å·²ç»è¢«å»ºç«‹å‡ºæ¥çš„ã€‚è¿™ä¸ªå¯¹è±¡å·²ç»è¢«ç”Ÿäº§å‡ºæ¥äº†ï¼Œè™½ç„¶è¿˜ä¸å®Œç¾(å°šæœªè¿›è¡Œåˆå§‹åŒ–çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥)ï¼Œå¯æ˜¯å·²ç»èƒ½è¢«äººè®¤å‡ºæ¥äº†(æ ¹æ®å¯¹è±¡å¼•ç”¨èƒ½å®šä½åˆ°å †ä¸­çš„å¯¹è±¡)ï¼Œå› æ­¤Springæ­¤æ—¶å°†è¿™ä¸ªå¯¹è±¡ææ—©æ›å…‰å‡ºæ¥è®©ä½ ä»¬è®¤è¯†ï¼Œè®©ä½ ä»¬ä½¿ç”¨ã€‚</p>
<h2 id="springä¸ºä½•ä¸èƒ½è§£å†³éå•ä¾‹å±æ€§ä¹‹å¤–çš„å¾ªç¯ä¾èµ–">Springä¸ºä½•ä¸èƒ½è§£å†³éå•ä¾‹å±æ€§ä¹‹å¤–çš„å¾ªç¯ä¾èµ–ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#springä¸ºä½•ä¸èƒ½è§£å†³éå•ä¾‹å±æ€§ä¹‹å¤–çš„å¾ªç¯ä¾èµ–">#</a></h2>
<h3 id="springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³æ„é€ å™¨çš„å¾ªç¯ä¾èµ–">#</a></h3>
<p>æ„é€ å™¨æ³¨å…¥å½¢æˆçš„å¾ªç¯ä¾èµ–: ä¹Ÿå°±æ˜¯BeanBéœ€è¦åœ¨beanAçš„æ„é€ å‡½æ•°ä¸­å®Œæˆåˆå§‹åŒ–ï¼ŒbeanAä¹Ÿéœ€è¦2åœ¨beanBçš„æ„é€ å‡½æ•°ä¸­å®Œæˆåˆå§‹åŒ–ï¼Œè¿™ç§æƒ…å†µçš„ç»“æœå°±æ˜¯ä¸¤ä¸ªbeanéƒ½ä¸èƒ½å®Œæˆåˆå§‹åŒ–ï¼Œå¾ªç¯ä¾èµ–éš¾ä»¥è§£å†³ã€‚</p>
<p>Springè§£å†³å¾ªç¯ä¾èµ–ä¸»è¦æ˜¯ä¾èµ–ä¸‰çº§ç¼“å­˜ï¼Œä½†æ˜¯å¾—åœ¨è°ƒç”¨æ„é€ æ–¹æ³•ä¹‹å‰è¿˜æœªå°†å…¶æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¹‹ä¸­ï¼Œå› æ­¤åç»­å¾—ä¾èµ–è°ƒç”¨æ„é€ æ–¹æ³•çš„æ—¶å€™å¹¶ä¸èƒ½ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–åˆ°ä¾èµ–çš„Beanï¼Œå› æ­¤ä¸èƒ½è§£å†³ã€‚</p>
<h3 id="springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸå¾ªç¯ä¾èµ–">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸå¾ªç¯ä¾èµ–<a hidden class="anchor" aria-hidden="true" href="#springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³prototypeä½œç”¨åŸŸå¾ªç¯ä¾èµ–">#</a></h3>
<p>è¿™ç§å¾ªç¯ä¾èµ–åŒæ ·æ— æ³•è§£å†³ï¼Œå› ä¸ºSpringä¸ä¼šç¼“å­˜prototypeä½œç”¨åŸŸçš„beanï¼Œè€Œspringä¸­å¾ªç¯ä¾èµ–çš„è§£å†³æ­£æ˜¯é€šè¿‡ç¼“å­˜æ¥å®ç°çš„ã€‚</p>
<h3 id="springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–">Springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#springä¸ºä»€ä¹ˆä¸èƒ½è§£å†³å¤šä¾‹çš„å¾ªç¯ä¾èµ–">#</a></h3>
<p>å¤šå®ä¾‹Beanæ˜¯æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡getBeanéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡æ„é€ æ–¹æ³•å¹¶ä¸”ç»™å±æ€§èµ‹å€¼ï¼Œæ ¹æœ¬æ²¡æœ‰ä¸‰çº§ç¼“å­˜ï¼Œå› æ­¤ä¸èƒ½è§£å†³å¾ªç¯ä¾èµ–ã€‚</p>
<h2 id="é‚£ä¹ˆå…¶ä»–å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³">é‚£ä¹ˆå…¶ä»–å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#é‚£ä¹ˆå…¶ä»–å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³">#</a></h2>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œç±»ä¼¼çš„ä¾èµ–æ˜¯å¦‚ä½•è§£å†³ï¼Ÿ</p>
<li>ç”Ÿæˆä»£ç†å¯¹è±¡äº§ç”Ÿçš„å¾ªç¯ä¾èµ–</li>
<p>è¿™ç±»å¾ªç¯ä¾èµ–è§£å†³æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸»è¦æœ‰ï¼š</p>
<p>1ã€ä½¿ç”¨@Lazyæ³¨è§£ï¼Œå»¶è¿ŸåŠ è½½</p>
<p>2ã€ä½¿ç”¨@DependsOnæ³¨è§£ï¼ŒæŒ‡å®šåŠ è½½å…ˆåå…³ç³»</p>
<p>3ã€ä¿®æ”¹æ–‡ä»¶åç§°ï¼Œæ”¹å˜å¾ªç¯ä¾èµ–ç±»çš„åŠ è½½é¡ºåº</p>
<li>ä½¿ç”¨@DependsOnäº§ç”Ÿçš„å¾ªç¯ä¾èµ–</li>
è¿™ç±»å¾ªç¯ä¾èµ–é—®é¢˜è¦æ‰¾åˆ°@DependsOnæ³¨è§£å¾ªç¯ä¾èµ–çš„åœ°æ–¹ï¼Œè¿«ä½¿å®ƒä¸å¾ªç¯ä¾èµ–å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚
<li>å¤šä¾‹å¾ªç¯ä¾èµ–</li>
è¿™ç±»å¾ªç¯ä¾èµ–é—®é¢˜å¯ä»¥é€šè¿‡æŠŠbeanæ”¹æˆå•ä¾‹çš„è§£å†³
<li>æ„é€ å™¨å¾ªç¯ä¾èµ–</li>
è¿™ç±»å¾ªç¯ä¾èµ–é—®é¢˜å¯ä»¥é€šè¿‡ä½¿ç”¨@Lazyæ³¨è§£è§£å†³ã€‚
<h2 id="é‡ç‚¹-springä¸­beançš„ç”Ÿå‘½å‘¨æœŸ">é‡ç‚¹: Springä¸­Beançš„ç”Ÿå‘½å‘¨æœŸ<a hidden class="anchor" aria-hidden="true" href="#é‡ç‚¹-springä¸­beançš„ç”Ÿå‘½å‘¨æœŸ">#</a></h2>
<p>Springåªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼Beançš„å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äºprototypeçš„beanï¼ŒSPringåœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹ååˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>Springå®¹å™¨å¯ä»¥ç®¡ç†singletonä½œç”¨åŸŸBeançš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ­¤ä½œç”¨åŸŸä¸‹ï¼ŒSPringèƒ½å¤Ÿç²¾ç¡®åœ°çŸ¥é“è¯¥Beanä½•æ—¶è¢«åˆ›å»ºï¼Œä½•æ—¶åˆå§‹åŒ–å®Œæˆï¼Œä»¥åŠä½•æ—¶è¢«é”€æ¯ã€‚</p>
<p>è€Œå¯¹äºprototypeä½œç”¨åŸŸçš„Bean,Springåªè´Ÿè´£åˆ›å»ºï¼Œå½“å®¹å™¨åˆ›å»ºäº†Beançš„å®ä¾‹åï¼ŒBeançš„å®ä¾‹å°±äº¤ç»™å®¢æˆ·ç«¯ä»£ç ç®¡ç†ï¼ŒSpringå®¹å™¨å°±ä¸å†è·Ÿè¸ªå…¶ç”Ÿå‘½å‘¨æœŸã€‚æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚prototypeä½œç”¨åŸŸçš„Beanæ—¶ï¼ŒSPringå®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶ä¸”ä¸ä¼šç®¡é‚£äº›è¢«é…ç½®æˆprototypeä½œç”¨åŸŸçš„Beançš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>äº†è§£SPringç”Ÿå‘½å‘¨æœŸçš„æ„ä¹‰å°±åœ¨äºï¼Œ<b>å¯ä»¥åˆ©ç”¨Beanåœ¨å…¶å­˜è´§æœŸé—´çš„æŒ‡å®šæ—¶åˆ»å®Œæˆä¸€äº›ç›¸å…³æ“ä½œã€‚è¿™ç§æ—¶åˆ»å¯èƒ½æœ‰å¾ˆå¤šï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼šåœ¨Beanè¢«åˆå§‹åŒ–åå’Œè¢«é”€æ¯å‰æ‰§è¡Œä¸€äº›ç›¸å…³æ“ä½œã€‚</b></p>
<p>Spring Beanç”Ÿå‘½å‘¨æœŸæµç¨‹</p>
<p>åœ¨SPringä¸­ï¼ŒBeançš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Springæä¾›çš„æ–¹æ³•å®šåˆ¶Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<li>å¦‚æœBeanFactoryPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™è°ƒç”¨postProcessBeanFactoryæ–¹æ³•.(å³é¦–å…ˆå°è¯•ä»Beanå·¥å‚ä¸­è·å–Bean)</li>
<li>å¦‚æœInstantiationAwareBeanPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™è°ƒç”¨postProcessBeforeInstantiationæ–¹æ³•</li>
<li>æ ¹æ®é…ç½®æƒ…å†µè°ƒç”¨Beanæ„é€ æ–¹æ³•å®ä¾‹åŒ–Beanã€‚</li>
<li>åˆ©ç”¨ä¾èµ–æ³¨å…¥å®ŒæˆBeanä¸­æ‰€æœ‰å±æ€§å€¼çš„é…ç½®æ³¨å…¥ã€‚</li>
<li>å¦‚æœInstantiationAwareBeanPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™è°ƒç”¨postProcessAfterInstantitionæ–¹æ³•å’ŒpostProcessProperties</li>
<li>è°ƒç”¨xxxAwareæ¥å£(ä¸Šå›¾åªæ˜¯ç»™äº†å‡ ä¸ªä¾‹å­)<br>
1ã€å¦‚æœbeanå®ç°äº†BeanNameAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨Beançš„setBeanName()æ–¹æ³•ä¼ å…¥å½“å‰Beançš„idå€¼ã€‚<br>
2ã€å¦‚æœBeanå®ç°äº†BeanClassLoaderAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨setBeanClassLoader()æ–¹æ³•ä¼ å…¥classLoaderçš„å¼•ç”¨ã€‚<br>
3ã€å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨setBeanFactory()æ–¹æ³•ä¼ å…¥å½“å‰å·¥å‚å®ä¾‹çš„å¼•ç”¨ã€‚
</li>
<li>ç¬¬äºŒç±»Awareæ¥å£<br>
1ã€å¦‚æœBeanå®ç°äº†EnvironmentAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨setEnviroment()æ–¹æ³•ä¼ å…¥å½“å‰Enviromentå®ä¾‹çš„å¼•ç”¨ã€‚<br>
2ã€å¦‚æœBeanå®ç°äº†EmbeddedValueResolverAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨setEmbeddedValueResolver()æ–¹æ³•ä¼ å…¥å½“å‰StringValueResolverå®ä¾‹çš„å¼•ç”¨ã€‚<br>
3ã€å¦‚æœBeanå®ç°äº†ApplicationContextAwareæ¥å£ï¼Œåˆ™Springè°ƒç”¨setApplicationContext()æ–¹æ³•ä¼ å…¥å½“å‰ApplicationContextå®ä¾‹çš„å¼•ç”¨ã€‚
</li>
<li>å¦‚æœBeanPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™SPringå°†è°ƒç”¨è¯¥æ¥å£çš„é¢„åˆå§‹åŒ–æ–¹æ³•postProcessBeforeInitialzation()å¯¹Beanè¿›è¡ŒåŠ å·¥æ“ä½œï¼Œæ­¤å¤„éå¸¸é‡è¦ï¼ŒSPringçš„AOPå°±æ˜¯åˆ©ç”¨å®ƒå®ç°çš„</li>
<li>å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼Œåˆ™SPringå°†è°ƒç”¨afterPropertiesSet()æ–¹æ³•ã€‚(æˆ–è€…æœ‰æ‰§è¡Œ@PostConstructæ³¨è§£çš„æ–¹æ³•)</li>
<li>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡init-methodå±æ€§æŒ‡å®šäº†åˆå§‹åŒ–æ–¹æ³•ï¼Œåˆ™è°ƒç”¨è¯¥åˆå§‹åŒ–æ–¹æ³•</li>
<li>å¦‚æœBeanPostProcessorå’ŒBeanå…³è”ï¼Œåˆ™Springå°†è°ƒç”¨è¯¥æ¥å£çš„åˆå§‹åŒ–æ–¹æ³•postProcesasAfterInitialization()ã€‚æ­¤æ—¶ï¼ŒBeanå·²ç»å¯ä»¥è¢«åº”ç”¨ç³»ç»Ÿä½¿ç”¨äº†ã€‚</li>
<li>å¦‚æœåœ¨beanä¸­æŒ‡å®šäº†è¯¥Beançš„ä½œç”¨èŒƒå›´ä¸ºscope="singleton"ï¼Œåˆ™å°†è¯¥Beanæ”¾å…¥Spring IoCçš„ç¼“å­˜æ± ä¸­ï¼Œå°†è§¦å‘Springå¯¹è¯¥Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†;å¦‚æœåœ¨beanä¸­æŒ‡å®šäº†è¯¥Beançš„ä½œç”¨èŒƒå›´ä¸ºscope="prototype"ï¼Œåˆ™å°†è¯¥Beanäº¤ç»™è°ƒç”¨è€…ï¼Œè°ƒç”¨è€…ç®¡ç†è¯¥Beançš„ç”Ÿå‘½å‘¨æœŸï¼ŒSpringä¸å†ç®¡ç†è¯¥Bean.</li>
<li>å¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™Springä¼šè°ƒç”¨destory()æ–¹æ³•å°†SPringä¸­çš„Beané”€æ¯ï¼›</li>
<li>å¦‚æœåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡destory-methodå±æ€§æŒ‡å®šäº†Beançš„é”€æ¯æ–¹æ³•ï¼Œåˆ™Springå°†è°ƒç”¨è¯¥æ–¹æ³•å¯¹Beanè¿›è¡Œé”€æ¯ã€‚</li>
<p><b>Beançš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç»å†äº†å„ç§æ–¹æ³•è°ƒç”¨ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç±»:</b></p>
<li><b>Beanè‡ªèº«çš„æ–¹æ³•</b>: è¿™ä¸ªåŒ…æ‹¬äº†Beanæœ¬èº«è°ƒç”¨çš„æ–¹æ³•å’Œé€šè¿‡é…ç½®æ–‡ä»¶ä¸­beançš„init-methodå’Œdestroy-methodæŒ‡å®šçš„æ–¹æ³•</li>
<li><b>Beançº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•</b>: è¿™ä¸ªåŒ…æ‹¬äº†BeanNameAwareã€BeanFactoryAwareã€ApplicationContextAwareï¼›å½“ç„¶ä¹ŸåŒ…æ‹¬InitializingBeanå’ŒDiposableBeanè¿™äº›æ¥å£çš„æ–¹æ³•(å¯ä»¥è¢«@PostConstructå’Œ@PreDestroyæ³¨è§£æ›¿ä»£)</li>
<li><b>å®¹å™¨çº§ç”Ÿå‘½å‘¨æœŸæ¥å£æ–¹æ³•:</b> è¿™ä¸ªåŒ…æ‹¬äº†AspectJWeavingEnable,ConfigurationClassPostProcessor,CustomAutowireConfigurerç­‰çš„éå¸¸æœ‰ç”¨çš„å·¥å‚åå¤„ç†æ¥å£çš„æ–¹æ³•ï¼Œå·¥å‚åå¤„ç†å™¨ä¹Ÿæ˜¯å®¹å™¨çº§çš„ã€‚åœ¨åº”ç”¨ä¸Šä¸‹æ–‡è£…é…æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨ã€‚</li>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://csqread.top/tags/spring/">spring</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://csqread.top/posts/tech/nio%E8%AF%A6%E8%A7%A3/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>NIOè¯¦è§£</span>
  </a>
  <a class="next" href="https://csqread.top/posts/tech/20240304%E5%8A%9B%E6%89%A3%E5%91%A8%E8%B5%9B/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>20240304åŠ›æ‰£å‘¨èµ›</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://csqread.top">Qian&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
